<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Strategic Planning in the NGO Sector · Digital Literacy for Artisans</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Questrial&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root {
      --primary-sage: #7A8471;
      --secondary-sage: #9CAF88;
      --tertiary-sage: #B8C5A6;
      --warm-cream: #F8F6F0;
      --soft-white: #FEFCF7;
      --forest-shadow: #5A6B52;
      --ink: #2F3A2B;
      --ink-muted: #5A6B52;
      --border-sage: rgba(122,132,113,0.20);
      --hover-sage: rgba(156,175,136,0.15);
      --deep-forest: #3E4A3A;
      --font-display: 'Questrial', system-ui, sans-serif;
      --font-body: 'Nunito', system-ui, sans-serif;
      --font-size-adjustment: 0pt;
      --step--1: calc(clamp(0.9rem, 0.85rem + 0.1vw, 0.95rem) + var(--font-size-adjustment));
      --step-0: calc(clamp(1rem, 0.95rem + 0.2vw, 1.1rem) + var(--font-size-adjustment));
      --step-1: calc(clamp(1.125rem, 1.05rem + 0.35vw, 1.35rem) + var(--font-size-adjustment));
      --step-2: calc(clamp(1.35rem, 1.2rem + 0.6vw, 1.7rem) + var(--font-size-adjustment));
      --step-3: calc(clamp(1.8rem, 1.5rem + 1vw, 2.3rem) + var(--font-size-adjustment));
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-7: 2rem;
      --radius: 16px;
      --radius-lg: 20px;
      --shadow-1: 0 1px 2px rgba(34,41,32,0.05), 0 2px 8px rgba(34,41,32,0.06);
      --shadow-2: 0 6px 24px rgba(34,41,32,0.08), 0 16px 36px rgba(34,41,32,0.08);
      --shadow-glow: 0 0 45px 10px color-mix(in srgb, var(--secondary-sage) 15%, transparent);
      --toolbar-h: 72px;
      --workspace-pad: 24px;
      --stage-pad: clamp(32px, 5vw, 64px);
      --stage-radius: 18px;
      --slide-aspect-w: 16;
      --slide-aspect-h: 9;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    html, body {
      margin: 0;
      padding: 0;
      min-height: 100dvh;
      color: var(--forest-shadow);
      background: linear-gradient(135deg, #F8F6F0 0%, #F5F3ED 100%);
      font-family: var(--font-body);
      font-size: var(--step-0);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      overflow: auto;
    }

    .deck-app {
      display: grid;
      grid-template-rows: var(--toolbar-h) 1fr;
      min-height: 100dvh;
    }

    .deck-toolbar {
      position: sticky;
      top: 0;
      z-index: 50;
      height: var(--toolbar-h);
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: var(--space-4);
      padding: 0 max(24px, 4vw);
      background: color-mix(in srgb, var(--soft-white) 85%, transparent);
      border-bottom: 1px solid var(--border-sage);
      box-shadow: 0 8px 20px rgba(34,41,32,0.05);
      backdrop-filter: blur(8px) saturate(1.1);
    }

    .toolbar-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-family: var(--font-display);
      font-size: calc(1.05rem + var(--font-size-adjustment));
      color: var(--forest-shadow);
    }

    .toolbar-brand span {
      letter-spacing: 0.04em;
      text-transform: uppercase;
      font-weight: 600;
    }

    .toolbar-actions {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .toolbar-btn {
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.15rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      background: var(--primary-sage);
      color: #fff;
      box-shadow: var(--shadow-1);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .toolbar-btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-2);
    }

    .toolbar-btn.secondary {
      background: var(--deep-forest);
    }

    .toolbar-btn.ghost {
      background: var(--soft-white);
      color: var(--forest-shadow);
      border: 1px solid var(--border-sage);
      box-shadow: none;
    }

    .toolbar-btn.ghost:hover {
      box-shadow: var(--shadow-1);
    }

    .toolbar-select {
      border-radius: 999px;
      border: 1px solid var(--border-sage);
      background: #fff;
      padding: 0.45rem 1rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      color: var(--forest-shadow);
      cursor: pointer;
    }

    .toolbar-select:focus {
      outline: 2px solid var(--primary-sage);
      outline-offset: 2px;
    }

    .highlight-controls {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.65);
      box-shadow: var(--shadow-1);
    }

    .highlight-controls i {
      color: var(--forest-shadow);
    }

    .text-highlight {
      background-color: var(--highlight-color, rgba(249, 226, 125, 0.85));
      padding: 0.05em 0.15em;
      border-radius: 0.35em;
      box-decoration-break: clone;
      -webkit-box-decoration-break: clone;
      transition: background-color 200ms ease;
    }

    .slide-counter {
      font-family: var(--font-display);
      color: var(--ink-muted);
    }

    .deck-workspace {
      height: calc(100dvh - var(--toolbar-h));
      padding: var(--workspace-pad);
      display: grid;
      place-items: center;
      overflow: hidden;
      background:
        radial-gradient(900px 600px at 20% 0%, rgba(156,175,136,0.08) 0%, transparent 70%),
        radial-gradient(800px 700px at 80% 100%, rgba(90,107,82,0.06) 0%, transparent 70%);
    }

    .stage-viewport {
      position: relative;
      display: grid;
      place-items: center;
    }

    .slide-stage {
      position: relative;
      border-radius: var(--stage-radius);
      background-color: var(--soft-white);
      box-shadow: var(--shadow-glow), 0 24px 60px rgba(34,41,32,0.10);
      aspect-ratio: var(--slide-aspect-w) / var(--slide-aspect-h);
      width: min(calc((100dvh - var(--toolbar-h) - (var(--workspace-pad) * 2)) * (var(--slide-aspect-w) / var(--slide-aspect-h))), calc(100vw - (var(--workspace-pad) * 2)));
      max-width: 100%;
      overflow: hidden auto;
      outline: 1px solid var(--border-sage);
      transition: opacity 300ms ease-in-out;
    }

    .slide-stage.hidden {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .slide-inner {
      position: absolute;
      inset: 0;
      padding: var(--stage-pad);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      gap: 1.25rem;
      overflow-y: auto;
      scrollbar-gutter: stable both-edges;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 24px;
      width: 100%;
      height: 100%;
      align-items: center;
    }

    .col-span-5 { grid-column: span 5 / span 5; }
    .col-span-6 { grid-column: span 6 / span 6; }
    .col-span-7 { grid-column: span 7 / span 7; }
    .col-span-8 { grid-column: span 8 / span 8; }
    .col-span-12 { grid-column: span 12 / span 12; }
    .col-start-7 { grid-column-start: 7; }
    .align-center { align-self: center; }

    .card {
      background: color-mix(in srgb, var(--warm-cream) 40%, var(--soft-white) 60%);
      border: 1px solid var(--border-sage);
      border-radius: var(--radius);
      padding: var(--space-6);
      box-shadow: var(--shadow-1);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .interactive-block {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .card h3, .card h4 {
      margin: 0;
      font-family: var(--font-display);
      color: var(--deep-forest);
    }

    .card p { margin: 0; font-size: var(--step--1); }

    .card ul {
      margin: 0;
      padding-left: 1.1rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-size: var(--step--1);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: var(--step--1);
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      background: rgba(156,175,136,0.15);
      color: var(--deep-forest);
      font-weight: 600;
      width: fit-content;
    }

    .icon-ring {
      width: 72px;
      height: 72px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 30% 30%, rgba(122,132,113,0.25), transparent 70%),
                  linear-gradient(135deg, rgba(156,175,136,0.35), rgba(122,132,113,0.15));
      color: var(--deep-forest);
      font-size: 1.65rem;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.35), 0 12px 24px rgba(62,74,58,0.15);
    }

    h1 {
      font-family: var(--font-display);
      font-size: calc(clamp(2.5rem, 1.4rem + 3.2vw, 4.2rem) + var(--font-size-adjustment));
      line-height: 1.1;
      color: var(--deep-forest);
      margin: 0;
    }

    h2 {
      font-family: var(--font-display);
      font-size: calc(clamp(1.8rem, 1.2rem + 2vw, 3rem) + var(--font-size-adjustment));
      line-height: 1.2;
      color: var(--deep-forest);
      margin: 0;
    }

    h3 { font-family: var(--font-display); color: var(--deep-forest); margin: 0; }

    p, li {
      font-size: calc(clamp(1rem, 0.95rem + 0.35vw, 1.2rem) + var(--font-size-adjustment));
      color: var(--forest-shadow);
    }

    .full-width-bg {
      background: transparent;
    }

    .full-width-bg .slide-inner { padding: 0; }

    .bg-media {
      position: absolute;
      inset: 0;
      z-index: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transform: scale(1.02);
      transition: transform 1200ms ease-in-out;
    }

    .bg-media.remote-image-fallback {
      background: linear-gradient(
        135deg,
        rgba(16, 28, 21, 0.85) 0%,
        rgba(16, 28, 21, 0.6) 65%,
        rgba(16, 28, 21, 0.45) 100%
      );
    }

    .bg-media.remote-image-fallback img {
      display: none;
    }

    .full-width-bg:not(.hidden) .bg-media {
      transform: scale(1);
    }

    .img-overlay {
      position: absolute;
      inset: 0;
      z-index: 1;
      pointer-events: none;
    }

    .bg-content {
      position: relative;
      z-index: 2;
      padding: var(--stage-pad);
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      align-items: flex-start;
    }

    .bg-content.centered {
      align-items: center;
      text-align: center;
      justify-content: center;
    }

    .overlay-card {
      background: color-mix(in srgb, rgba(16,28,21,0.72) 65%, rgba(248,246,240,0.35) 35%);
      border: 1px solid rgba(253,251,245,0.35);
      border-radius: calc(var(--radius-lg) + 8px);
      padding: clamp(28px, 5vw, 48px);
      box-shadow: 0 24px 60px rgba(8,16,12,0.4);
      backdrop-filter: blur(14px) saturate(125%);
      color: #FDFBF5;
      max-width: min(560px, 70%);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .overlay-card.centered {
      margin: 0 auto;
      text-align: center;
      align-items: center;
    }

    .overlay-card h1,
    .overlay-card h2,
    .overlay-card p,
    .overlay-card .pill,
    .overlay-card .deck-subtitle {
      color: #FDFBF5;
    }

    .overlay-card .deck-subtitle {
      font-size: var(--step-1);
      margin: 0;
      color: rgba(253,251,245,0.85);
    }

    .overlay-pill {
      background: rgba(253,251,245,0.22) !important;
      color: #FDFBF5 !important;
      box-shadow: inset 0 0 0 1px rgba(253,251,245,0.28);
    }

    .centered-text { text-align: center; align-items: center; }

    .objectives-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .objectives-list li {
      background: rgba(254,252,247,0.85);
      border-radius: var(--radius);
      padding: 0.85rem 1.1rem;
      box-shadow: var(--shadow-1);
      font-size: var(--step--1);
    }

    .grounding-layout {
      display: grid;
      grid-template-columns: 4fr 3fr;
      gap: 24px;
      align-items: stretch;
    }

    .grounding-image {
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid rgba(122,132,113,0.18);
      box-shadow: var(--shadow-2);
    }

    .grounding-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .grounding-image::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(150deg, rgba(0,0,0,0.35) 0%, rgba(0,0,0,0.05) 65%);
    }

    .grounding-image .caption {
      position: absolute;
      bottom: 16px;
      left: 20px;
      right: 20px;
      color: #fff;
      font-weight: 600;
      font-size: calc(0.95rem + var(--font-size-adjustment));
      z-index: 1;
    }

    .discussion-table {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
    }

    .discussion-table .card { height: 100%; }

    .table-completion-wrapper {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .report-text {
      background: rgba(156,175,136,0.12);
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.2);
      padding: 1.25rem 1.5rem;
      font-size: var(--step--1);
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid rgba(122,132,113,0.25);
      padding: 0.9rem 1rem;
      text-align: left;
      vertical-align: top;
      background: rgba(254,252,247,0.9);
      font-size: var(--step--1);
    }
    .drop-zone {
      min-height: 52px;
      width: 100%;
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      padding: 0.55rem 0.85rem;
      border-radius: 14px;
      border: 2px dashed rgba(122,132,113,0.35);
      background: rgba(254,252,247,0.75);
      font-family: var(--font-body);
      font-weight: 600;
      font-size: var(--step--1);
      color: var(--forest-shadow);
      text-align: left;
      cursor: pointer;
      transition: border 0.2s ease, background 0.2s ease, transform 0.2s ease;
      position: relative;
      gap: 0.55rem;
    }

    .drop-zone.placeholder {
      color: rgba(47,58,43,0.55);
      font-style: italic;
      font-weight: 500;
    }

    .drop-zone::after {
      content: '\f063';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-left: auto;
      color: rgba(90,107,82,0.45);
      font-size: 0.85em;
      transition: transform 0.2s ease, color 0.2s ease;
    }

    .drop-zone.placeholder::after { content: '\f078'; }

    .drop-zone:hover {
      border-color: var(--secondary-sage);
      background: rgba(156,175,136,0.18);
      transform: translateY(-1px);
    }

    .drop-zone.active,
    .drop-zone.selected {
      border-style: solid;
      border-color: var(--primary-sage);
      background: rgba(156,175,136,0.22);
    }

    .drop-zone.filled::after {
      color: var(--primary-sage);
      transform: rotate(-180deg);
    }

    .drop-zone.correct {
      border-color: #2E7D32;
      background: rgba(46,125,50,0.16);
    }

    .drop-zone.incorrect {
      border-color: #C62828;
      background: rgba(198,40,40,0.16);
    }

    .token-bank {
      display: flex;
      flex-wrap: wrap;
      gap: 0.65rem;
      padding: 1rem 1.1rem;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(248,246,240,0.92), rgba(236,231,220,0.75));
      border: 1px dashed rgba(122,132,113,0.28);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.5);
    }

    .click-token {
      padding: 0.55rem 1rem;
      border-radius: 999px;
      background: var(--soft-white);
      border: 1px solid rgba(122,132,113,0.35);
      box-shadow: var(--shadow-1);
      cursor: pointer;
      font-weight: 600;
      font-size: var(--step--1);
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      color: var(--forest-shadow);
      position: relative;
    }

    .click-token:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-2);
    }

    .click-token.selected {
      background: var(--secondary-sage);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 12px 30px rgba(122,132,113,0.35);
    }

    .click-token.used {
      opacity: 0.35;
      pointer-events: none;
    }

    .activity-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      margin-top: 0.5rem;
    }

    .activity-btn {
      padding: 0.65rem 1.4rem;
      border-radius: 999px;
      border: 1px solid var(--primary-sage);
      background: var(--primary-sage);
      color: #fff;
      font-family: var(--font-body);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .activity-btn.secondary {
      background: transparent;
      color: var(--primary-sage);
      border-color: rgba(122,132,113,0.3);
    }

    .activity-btn:hover {
      box-shadow: var(--shadow-2);
      transform: translateY(-1px);
    }

    .feedback-msg {
      font-size: calc(0.95rem + var(--font-size-adjustment));
      font-weight: 600;
      margin-top: 0.4rem;
    }

    .feedback-msg.success { color: #2E7D32; }
    .feedback-msg.error { color: #C62828; }

    .quiz-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
    }

    .quiz-grid.single-column { grid-template-columns: 1fr; }

    .quiz-card {
      background: var(--soft-white);
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.2);
      padding: 1.2rem 1.4rem;
      box-shadow: var(--shadow-1);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .quiz-options {
      display: grid;
      gap: 0.45rem;
    }

    .quiz-option {
      display: flex;
      align-items: flex-start;
      gap: 0.6rem;
      padding: 0.45rem 0.6rem;
      border-radius: 12px;
      background: rgba(250,250,248,0.9);
      border: 1px solid transparent;
    }

    .quiz-option.correct { border-color: #2E7D32; background: rgba(46,125,50,0.12); }
    .quiz-option.incorrect { border-color: #C62828; background: rgba(198,40,40,0.12); }

    .audio-player {
      background: var(--soft-white);
      padding: 1.1rem 1.4rem;
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.2);
      box-shadow: var(--shadow-1);
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    audio { width: 100%; }

    .stress-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    .stress-example {
      background: linear-gradient(135deg, rgba(248,246,240,0.95), rgba(236,231,220,0.8));
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.2);
      box-shadow: var(--shadow-1);
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .stress-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(122,132,113,0.15);
      color: var(--deep-forest);
      font-weight: 700;
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      font-size: calc(0.9rem + var(--font-size-adjustment));
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .stress-highlight {
      color: var(--primary-sage);
      text-decoration: underline wavy rgba(122,132,113,0.45);
      text-underline-offset: 6px;
    }

    .hint {
      color: var(--ink-muted);
      font-size: calc(0.95rem + var(--font-size-adjustment));
      margin: 0;
    }

    .dialogue-box {
      background: color-mix(in srgb, var(--warm-cream) 60%, transparent);
      border: 1px solid rgba(122,132,113,0.18);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      max-height: 260px;
      overflow-y: auto;
    }

    .role-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
    }

    .role-card {
      background: var(--soft-white);
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.18);
      padding: 1.2rem 1.4rem;
      box-shadow: var(--shadow-1);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .role-card.subtle {
      background: linear-gradient(135deg, rgba(254,252,247,0.92), rgba(244,240,230,0.82));
      border: 1px solid rgba(122,132,113,0.16);
    }

    .role-columns {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
    }

    .scenario-grid .role-card { height: 100%; }

    .section-break {
      position: relative;
      color: #fff;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .section-break .bg-content { align-items: center; }

    .content-body {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      font-size: var(--step--1);
    }

    .task-deliverable {
      background: rgba(156,175,136,0.12);
      border: 1px solid rgba(122,132,113,0.2);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .reflection-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
    }

    .matching-card {
      background: var(--soft-white);
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.18);
      box-shadow: var(--shadow-1);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .matching-stack {
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
    }

    .matching-option {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 1rem;
      align-items: center;
      background: color-mix(in srgb, var(--warm-cream) 60%, transparent);
      padding: 0.9rem 1rem;
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.16);
    }

    .matching-option select {
      font-family: var(--font-body);
      font-size: calc(1rem + var(--font-size-adjustment));
      font-weight: 600;
      color: var(--primary-sage);
      background: var(--soft-white);
      border-radius: 12px;
      border: 2px solid rgba(122,132,113,0.25);
      padding: 0.4rem 0.8rem;
    }

    .click-drop-sentences {
      display: grid;
      gap: 0.75rem;
    }

    .click-drop-sentences li {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.4rem;
      background: rgba(254,252,247,0.85);
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.2);
      padding: 0.75rem 1rem;
      font-size: var(--step--1);
    }

    .slide-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: color-mix(in srgb, var(--soft-white) 80%, transparent);
      border: 1px solid var(--border-sage);
      color: var(--primary-sage);
      display: grid;
      place-items: center;
      cursor: pointer;
      backdrop-filter: blur(4px);
      box-shadow: var(--shadow-1);
      opacity: 0.92;
      scale: 1;
      transition: all 200ms cubic-bezier(.2,.8,.2,1);
    }

    .stage-viewport:hover .slide-nav {
      opacity: 1;
      box-shadow: var(--shadow-2);
    }

    .slide-nav:hover {
      background: var(--soft-white);
      color: var(--deep-forest);
    }

    .slide-nav-prev { left: 24px; }
    .slide-nav-next { right: 24px; }

    .blank-slide {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      height: 100%;
    }

    .blank-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .blank-canvas {
      flex: 1;
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(122,132,113,0.35);
      background: rgba(254,252,247,0.8);
      padding: 1.5rem;
      position: relative;
      overflow: hidden auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      min-height: 320px;
    }

    .blank-hint {
      font-size: var(--step--1);
      color: var(--ink-muted);
    }

    .textbox {
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--radius);
      border: 1px solid rgba(122,132,113,0.35);
      box-shadow: var(--shadow-1);
      background: var(--soft-white);
      width: clamp(240px, 35%, 420px);
      min-height: 140px;
      display: flex;
      flex-direction: column;
      cursor: move;
      touch-action: none;
    }

    .textbox-handle {
      padding: 0.5rem 0.75rem;
      background: rgba(122,132,113,0.16);
      border-bottom: 1px solid rgba(122,132,113,0.2);
      font-weight: 700;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      font-size: 0.75rem;
      cursor: grab;
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
    }

    .textbox-body {
      flex: 1;
      padding: 0.75rem;
      font-family: var(--font-body);
      font-size: var(--step--1);
      line-height: 1.5;
      outline: none;
      cursor: text;
      overflow: auto;
    }

    .textbox-body:focus {
      box-shadow: inset 0 0 0 2px rgba(122,132,113,0.35);
    }

    .textbox-remove {
      position: absolute;
      top: 0.35rem;
      right: 0.35rem;
      border: none;
      background: rgba(254,252,247,0.8);
      color: var(--forest-shadow);
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: grid;
      place-items: center;
      cursor: pointer;
      box-shadow: var(--shadow-1);
    }

    .textbox-remove:hover { color: #C62828; }

    .mindmap {
      border-radius: var(--radius-lg);
      border: 1px solid rgba(122,132,113,0.35);
      background: linear-gradient(135deg, rgba(248,246,240,0.92), rgba(236,231,220,0.75));
      box-shadow: var(--shadow-1);
      padding: clamp(1.2rem, 3vw, 1.8rem);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .mindmap-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .mindmap-title {
      font-family: var(--font-display);
      font-size: var(--step-1);
      margin: 0;
      color: var(--deep-forest);
    }

    .mindmap-remove {
      border: none;
      background: transparent;
      color: var(--forest-shadow);
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .mindmap-remove:hover { color: #C62828; }

    .mindmap-center {
      align-self: center;
      min-width: 180px;
      padding: 0.9rem 1.1rem;
      border-radius: 999px;
      background: var(--primary-sage);
      color: #fff;
      font-weight: 700;
      text-align: center;
      font-family: var(--font-display);
      letter-spacing: 0.03em;
      outline: none;
    }

    .mindmap-center:focus {
      box-shadow: 0 0 0 3px rgba(156,175,136,0.35);
    }

    .mindmap-branches {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    .mindmap-branch {
      position: relative;
      padding: 0.75rem 0.85rem;
      border-radius: var(--radius);
      background: rgba(254,252,247,0.95);
      border: 1px solid rgba(122,132,113,0.2);
      box-shadow: var(--shadow-1);
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .mindmap-branch textarea {
      width: 100%;
      border: none;
      background: transparent;
      font-family: var(--font-body);
      font-size: var(--step--1);
      line-height: 1.5;
      resize: vertical;
      min-height: 64px;
    }

    .branch-remove {
      align-self: flex-end;
      border: none;
      background: transparent;
      color: var(--forest-shadow);
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .branch-remove:hover { color: #C62828; }

    .mindmap-form {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    .mindmap-form input {
      flex: 1 1 220px;
      border-radius: 999px;
      border: 1px solid rgba(122,132,113,0.35);
      padding: 0.45rem 0.85rem;
      font-family: var(--font-body);
      font-size: var(--step--1);
    }

    .mindmap-form button {
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.1rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      cursor: pointer;
      background: var(--secondary-sage);
      color: var(--forest-shadow);
      box-shadow: var(--shadow-1);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .mindmap-form button:hover {
      background: color-mix(in srgb, var(--secondary-sage) 85%, #fff 15%);
    }

    @media (max-width: 1024px) {
      .slide-inner { padding: clamp(24px, 6vw, 40px); }
      .grid-container { grid-template-columns: repeat(6, 1fr); }
      .col-span-6, .col-span-8, .col-span-12 { grid-column: span 6 / span 6; }
      .grounding-layout, .role-options, .scenario-grid,
      .role-columns, .quiz-grid, .stress-grid { grid-template-columns: 1fr; }
      .discussion-table { grid-template-columns: 1fr; }
      .section-break .bg-content { padding: clamp(24px, 6vw, 40px); }
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --soft-white: #1E211C;
        --warm-cream: #23261F;
        --forest-shadow: #DDE6D4;
        --ink: #E9EFE5;
        --ink-muted: #AEB9AA;
        --border-sage: rgba(184,197,166,0.25);
        --deep-forest: #E9EFE5;
        --primary-sage: #9CAF88;
        --shadow-glow: 0 0 50px 10px rgba(184,197,166,0.1);
      }
      body { background: linear-gradient(135deg, #191D18 0%, #1B1E19 100%); }
      .slide-stage { background: #161915; outline-color: rgba(184,197,166,0.20); box-shadow: var(--shadow-glow), 0 24px 60px rgba(0,0,0,0.35); }
      .card, .audio-player, .dialogue-box, .matching-list, .matching-options, .quiz-card {
        background: color-mix(in srgb, var(--warm-cream) 40%, var(--soft-white) 60%);
        border-color: rgba(184,197,166,0.25);
      }
      .token-bank { background: color-mix(in srgb, var(--warm-cream) 65%, var(--soft-white) 35%); }
    }
  </style>
</head>
<body>
  <div class="deck-app">
    <header class="deck-toolbar">
      <div class="toolbar-brand">
        <i class="fa-solid fa-laptop" style="color: var(--primary-sage);"></i>
        <span>Mosaic | Digital Literacy for Artisans</span>
      </div>
      <div id="slide-counter" class="slide-counter">1 / 19</div>
      <div class="toolbar-actions">
        <button id="save-state-btn" class="toolbar-btn" type="button">
          <i class="fa-solid fa-floppy-disk"></i>
          Save Deck
        </button>
        <button id="load-state-btn" class="toolbar-btn secondary" type="button">
          <i class="fa-solid fa-file-import"></i>
          Load Deck
        </button>
        <input id="load-state-input" class="sr-only" type="file" accept="application/json">
        <div class="highlight-controls" role="group" aria-label="Highlight text">
          <i class="fa-solid fa-highlighter" aria-hidden="true"></i>
          <label class="sr-only" for="highlight-color">Highlight colour</label>
          <select id="highlight-color" class="toolbar-select">
            <option value="#F9E27D">Sunbeam</option>
            <option value="#A5D6A7">Meadow</option>
            <option value="#FFCCBC">Coral</option>
          </select>
          <button id="highlight-btn" class="toolbar-btn ghost" type="button">Apply</button>
          <button id="remove-highlight-btn" class="toolbar-btn ghost" type="button">Clear</button>
        </div>
        <button id="add-slide-btn" class="toolbar-btn" type="button">
          <i class="fa-solid fa-plus"></i>
          Add Blank Slide
        </button>
      </div>
    </header>

    <main class="deck-workspace">
      <div class="stage-viewport">

        <!-- Slide 1 -->
        <div class="slide-stage full-width-bg">
          <div class="bg-media" style="background-image: url('https://images.pexels.com/photos/3815750/pexels-photo-3815750.jpeg?auto=compress&cs=tinysrgb&fit=crop&w=1920&h=1080');" role="presentation" aria-hidden="true"></div>
          <div class="img-overlay" style="background: linear-gradient(115deg, rgba(14,25,19,0.65) 0%, rgba(14,25,19,0.35) 48%, rgba(14,25,19,0.15) 80%, transparent 100%);"></div>
          <div class="slide-inner">
            <div class="bg-content">
              <div class="overlay-card">
                <span class="pill overlay-pill"><i class="fa-solid fa-landmark"></i> Mosaic Lesson Deck</span>
                <h1>Strategic Planning in the NGO Sector</h1>
                <p class="deck-subtitle">Digital Literacy for Artisans · Nablus</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 2 -->
        <div class="slide-stage hidden full-width-bg">
          <div class="bg-media" style="background-image: url('https://images.pexels.com/photos/1428277/pexels-photo-1428277.jpeg?auto=compress&cs=tinysrgb&fit=crop&w=1920&h=1080');" role="presentation" aria-hidden="true"></div>
          <div class="img-overlay" style="background: linear-gradient(145deg, rgba(9,28,18,0.55) 0%, rgba(9,28,18,0.3) 50%, rgba(9,28,18,0.1) 100%);"></div>
          <div class="slide-inner" style="justify-content: center;">
            <div class="bg-content centered">
              <div class="overlay-card centered">
                <span class="pill overlay-pill"><i class="fa-solid fa-leaf"></i> Grounding Activity</span>
                <h2>Box Breathing</h2>
                <p class="deck-subtitle">Breathe in for 4 seconds · Hold for 4 seconds · Breathe out for 4 seconds</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 3 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-list-check"></i> Lesson Aims</span>
            <h2>By the end of this lesson, you will be able to...</h2>
            <div class="card" style="gap: 1rem;">
              <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.85rem;">
                <li><i class="fa-solid fa-magnifying-glass-chart" style="margin-right: 10px; color: var(--primary-sage);"></i>Analyze a report on a local economic issue to identify key challenges.</li>
                <li><i class="fa-solid fa-scale-unbalanced" style="margin-right: 10px; color: var(--primary-sage);"></i>Evaluate two proposed strategies and justify your choice using persuasive language.</li>
                <li><i class="fa-solid fa-people-line" style="margin-right: 10px; color: var(--primary-sage);"></i>Collaborate with a group to summarize your analysis and recommendations.</li>
                <li><i class="fa-solid fa-bullhorn" style="margin-right: 10px; color: var(--primary-sage);"></i>Use sentence stress effectively to emphasize key data and findings in a discussion.</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Slide 4 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-lightbulb"></i> Pre-task A</span>
            <h2>Activate: Successful Local Artisans</h2>
            <div class="card" style="gap: 1rem;">
              <p><strong>Paired Discussion</strong></p>
              <ul>
                <li>Think of a successful local artisan or small business you know of in Palestine. What do they create or sell?</li>
                <li>What made their business successful? What challenges might they have faced?</li>
                <li>Why is supporting local artisans important for creating a sustainable local economy?</li>
              </ul>
              <p class="hint">Capture one key insight from your partner that you want to share with the group.</p>
            </div>
          </div>
        </div>

        <!-- Slide 5 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-file-alt"></i> Pre-task B · Part 1</span>
            <h2>Analyzing the Nablus Artisan Report</h2>
            <div class="table-completion-wrapper" data-activity="table-completion">
              <p class="report-text">A recent study in the Nablus governorate <em>found</em> online sales for local artisans <em>had fallen</em> by 20% in two years. It <em>identified</em> that the primary cause was not product quality but a lack of digital marketing skills, especially in product photography and social media engagement. The report <em>concluded</em> that simply building a central website for them was unlikely to foster long-term success.</p>
              <div class="card" style="gap: 1.25rem;">
                <p style="margin: 0;">Read the report summary. Then, click an answer below and tap the matching space in the table.</p>
                <div class="table-responsive">
                  <table>
                    <thead>
                      <tr>
                        <th style="width: 30%;">Finding</th>
                        <th>Details</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Key Statistic</td>
                        <td><button type="button" class="drop-zone placeholder" data-answer="fallen by 20% in two years" data-placeholder="Select answer" aria-label="Key statistic answer"></button></td>
                      </tr>
                      <tr>
                        <td>Primary Cause</td>
                        <td><button type="button" class="drop-zone placeholder" data-answer="lack of digital marketing skills" data-placeholder="Select answer" aria-label="Primary cause answer"></button></td>
                      </tr>
                      <tr>
                        <td>Main Conclusion</td>
                        <td><button type="button" class="drop-zone placeholder" data-answer="simply building a central website was unlikely to foster long-term success" data-placeholder="Select answer" aria-label="Main conclusion answer"></button></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="token-bank" aria-label="Answer options">
                  <button type="button" class="click-token" data-value="fallen by 20% in two years" data-token-id="table-token-1"><i class="fa-solid fa-chart-line"></i> fallen by 20% in two years</button>
                  <button type="button" class="click-token" data-value="poor product quality" data-token-id="table-token-2"><i class="fa-solid fa-circle-exclamation"></i> poor product quality</button>
                  <button type="button" class="click-token" data-value="lack of digital marketing skills" data-token-id="table-token-3"><i class="fa-solid fa-hashtag"></i> lack of digital marketing skills</button>
                  <button type="button" class="click-token" data-value="simply building a central website was unlikely to foster long-term success" data-token-id="table-token-4"><i class="fa-solid fa-globe"></i> simply building a central website was unlikely to foster long-term success</button>
                </div>
                <div class="activity-actions">
                  <button class="activity-btn secondary" type="button" data-action="reset">Reset</button>
                  <button class="activity-btn" type="button" data-action="check">Check</button>
                </div>
                <div class="feedback-msg" aria-live="polite"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 6 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-users"></i> Pre-task B · Part 2</span>
            <h2>Discussing the Report's Implications</h2>
            <div class="card" style="gap: 1rem;">
              <p>In your pairs, discuss these questions based on the report:</p>
              <ul>
                <li>The report states the main cause is a "lack of digital marketing skills." What does this look like in daily life for an artisan?</li>
                <li>Why do you think the report concluded that "simply building a central website was unlikely to foster long-term success"?</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Slide 7 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-brain"></i> Pre-task B · Part 3</span>
            <h2>Brainstorming Solutions</h2>
            <div class="card" style="gap: 1rem;">
              <p>Based on the report, the problem is skills, not product quality. In your groups, brainstorm a list of possible community-based projects to solve this problem. Be ready to share one idea.</p>
              <div class="discussion-table">
                <div class="card"><h3>Focus</h3><p>Which group of artisans in Nablus might need the most support to build their digital skills?</p></div>
                <div class="card"><h3>Approach</h3><p>What creative training activities could inspire artisans to market their products online?</p></div>
                <div class="card"><h3>Impact</h3><p>How might you measure whether their digital skills are truly improving?</p></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 8 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-headphones"></i> Pre-task C · Part 1</span>
            <h2>Model: Listening for Detail</h2>
            <div class="card quiz-wrapper" data-activity="mc-quiz" aria-labelledby="mc-quiz-title" style="gap: 1.4rem;">
              <div class="audio-player">
                <p>You will listen to a dialogue between two NGO workers, Fatima and Yousef, discussing how to set up a digital literacy pilot program in Nablus. Listen and answer the questions.</p>
                <audio controls>
                  <source src="assets/audio/ngo-artisan-literacy-discussion.mp3" type="audio/mpeg">
                  Your browser does not support the audio element.
                </audio>
              </div>
              <h3 id="mc-quiz-title" style="font-size: calc(1.2rem + var(--font-size-adjustment)); margin: 0;">Check Your Understanding</h3>
              <div class="quiz-grid single-column">
                  <div class="quiz-card" data-correct="c">
                    <p><strong>1.</strong> What key finding from the report does Fatima emphasize at the start?</p>
                    <div class="quiz-options">
                      <label class="quiz-option"><input type="radio" name="q1" value="a"> Sales fell by 20%.</label>
                      <label class="quiz-option"><input type="radio" name="q1" value="b"> The problem is product quality.</label>
                      <label class="quiz-option"><input type="radio" name="q1" value="c"> The core issue is a lack of digital skills.</label>
                    </div>
                  </div>
                  <div class="quiz-card" data-correct="c">
                    <p><strong>2.</strong> What is Yousef's proposed pilot program called?</p>
                    <div class="quiz-options">
                      <label class="quiz-option"><input type="radio" name="q2" value="a"> Artisan Online</label>
                      <label class="quiz-option"><input type="radio" name="q2" value="b"> The University Project</label>
                      <label class="quiz-option"><input type="radio" name="q2" value="c"> Digital Pioneers</label>
                    </div>
                  </div>
                  <div class="quiz-card" data-correct="b">
                    <p><strong>3.</strong> What is Fatima's main concern about focusing only on student mentors?</p>
                    <div class="quiz-options">
                      <label class="quiz-option"><input type="radio" name="q3" value="a"> It's too expensive.</label>
                      <label class="quiz-option"><input type="radio" name="q3" value="b"> It might be too slow and indirect for the artisans.</label>
                      <label class="quiz-option"><input type="radio" name="q3" value="c"> The university is not interested.</label>
                    </div>
                  </div>
                  <div class="quiz-card" data-correct="b">
                    <p><strong>4.</strong> What is the core activity in Fatima's "Artisan Accelerate" proposal?</p>
                    <div class="quiz-options">
                      <label class="quiz-option"><input type="radio" name="q4" value="a"> Giving out free smartphones.</label>
                      <label class="quiz-option"><input type="radio" name="q4" value="b"> Intensive, hands-on workshops for the artisans themselves.</label>
                      <label class="quiz-option"><input type="radio" name="q4" value="c"> Building an e-commerce website.</label>
                    </div>
                  </div>
                  <div class="quiz-card" data-correct="c">
                    <p><strong>5.</strong> What is their final decision?</p>
                    <div class="quiz-options">
                      <label class="quiz-option"><input type="radio" name="q5" value="a"> To choose Yousef's idea.</label>
                      <label class="quiz-option"><input type="radio" name="q5" value="b"> To reject Fatima's idea.</label>
                      <label class="quiz-option"><input type="radio" name="q5" value="c"> To create a hybrid program combining workshops and mentorship.</label>
                    </div>
                  </div>
              </div>
              <div class="activity-actions">
                <button class="activity-btn secondary" type="button" data-action="reset">Reset</button>
                <button class="activity-btn" type="button" data-action="check">Check</button>
              </div>
              <div class="feedback-msg" aria-live="polite"></div>
            </div>
          </div>
        </div>

        <!-- Slide 9 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-language"></i> Pre-task C · Part 2</span>
            <h2>Model: Language Analysis</h2>
            <div class="card" style="gap: 1.25rem;">
              <p>Read the transcript. In your pairs, identify the phrases Yousef and Fatima use to propose, justify, and express concerns about an idea.</p>
              <div class="dialogue-box">
                <p><strong>Fatima:</strong> Okay, so we’ve agreed that the Nablus report is clear: we need a digital skills program. The data <em>showed</em> that the biggest issue was a lack of marketing know-how, so that’s where we need to focus.</p>
                <p><strong>Yousef:</strong> Exactly. So, for the pilot program, <strong>I propose we start with</strong> a mentorship model. We could call it the "Digital Pioneers" program. We would train tech-savvy university students to mentor the artisans one-on-one. For me, <strong>the key to long-term sustainability is</strong> building those supportive relationships.</p>
                <p><strong>Fatima:</strong> I agree that mentorship is powerful. But, <strong>my only concern is that</strong> it might be too slow to show results. The artisans need skills now. <strong>An alternative approach could be to</strong> focus on direct training. I'm thinking of an "Artisan Accelerate" program.</p>
                <p><strong>Yousef:</strong> Tell me more. How would that work?</p>
                <p><strong>Fatima:</strong> We would run intensive, hands-on workshops on topics like smartphone photography and social media. <strong>The evidence strongly suggests that</strong> this kind of practical group training builds confidence quickly. We could measure success with follow-up surveys and by tracking their online sales.</p>
                <p><strong>Yousef:</strong> That’s a good point about building confidence. But I wonder if some artisans would be intimidated by a formal workshop. With the "Digital Pioneers" idea, the learning is personalized. <strong>The main advantage is that</strong> we can tailor the support to each person's needs.</p>
                <p><strong>Fatima:</strong> That's true. Custom support is better. But <strong>my priority would be</strong> ensuring a baseline of skills for everyone. Perhaps we can combine the ideas? We could run the workshops to teach the core skills, and then the student mentors could provide follow-up, one-on-one support.</p>
                <p><strong>Yousef:</strong> A hybrid model... I like that. <strong>It's the best of both worlds.</strong> We get the fast-paced group learning and the long-term personalized support. Okay, let's design that pilot.</p>
              </div>
              <ul>
                <li>What phrases do Yousef and Fatima use to introduce their ideas?</li>
                <li>How does Fatima express her concern about Yousef's idea without being too direct?</li>
                <li>What phrases do they use to justify their proposals with reasons?</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Slide 10 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-gavel"></i> Pre-task C · Part 3</span>
            <h2>Language Focus: Mini-Debate</h2>
            <div class="card" style="gap: 1rem;">
              <p>Your team needs to decide on the FIRST activity for the new digital literacy pilot program. In pairs, argue for one option below using phrases from the model.</p>
              <div class="role-options">
                <div class="role-card">
                  <h3>Option A</h3>
                  <p>Launch a workshop on "Smartphone Photography for Products."</p>
                  <p style="font-style: italic; color: var(--ink-muted);">Example: "I propose we start with the photography workshop because the key to success is making the products look great online."</p>
                </div>
                <div class="role-card">
                  <h3>Option B</h3>
                  <p>Host a networking event to connect artisans with successful local online sellers for inspiration.</p>
                  <p style="font-style: italic; color: var(--ink-muted);">Remember to justify your idea and acknowledge any concerns your partner raises.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 11 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-bullhorn"></i> Pre-task D · Part 1</span>
            <h2>Pronunciation: Using Stress to Emphasize Data</h2>
            <div class="card" style="gap: 1rem;">
              <p>Your teacher will model both sentences below. Notice which word is stressed and how the meaning shifts.</p>
              <div class="stress-grid">
                <div class="card">
                  <p><strong>Version A:</strong> The report showed a <strong>twenty</strong> percent decrease in online sales. <span class="hint">Use this when correcting the number, e.g., not fifty.</span></p>
                </div>
                <div class="card">
                  <p><strong>Version B:</strong> The report showed a twenty percent <strong>decrease</strong> in online sales. <span class="hint">Use this when correcting the trend, e.g., not an increase.</span></p>
                </div>
              </div>
              <p>In pairs, repeat the sentences, swapping roles. Exaggerate the stressed word.</p>
            </div>
          </div>
        </div>

        <!-- Slide 12 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-exchange-alt"></i> Pre-task D · Part 2</span>
            <h2>Scenario 1 · Checking the Facts</h2>
            <div class="card" style="gap: 1rem;">
              <p>Student A has the correct project data. Student B, your information is slightly off—ask questions and listen for the stressed corrections.</p>
              <div class="role-columns">
                <div class="role-card">
                  <h3>Student A · Project Analyst</h3>
                  <ul>
                    <li>Pilot program duration: <strong>Four</strong> months</li>
                    <li>Number of artisans involved: <strong>Fifteen</strong></li>
                    <li>Targeted increase in online sales: <strong>10%</strong></li>
                  </ul>
                </div>
                <div class="role-card">
                  <h3>Student B · Data Checker</h3>
                  <ul>
                    <li>Pilot program duration: Six months?</li>
                    <li>Number of artisans involved: Fifty?</li>
                    <li>Targeted increase in online sales: 30%?</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 13 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-exchange-alt"></i> Pre-task D · Part 3</span>
            <h2>Scenario 2 · Correcting a Colleague</h2>
            <div class="card" style="gap: 1rem;">
              <p>You are in a team meeting. Student B is presenting an outdated summary. Student A, step in kindly and stress the corrected information.</p>
              <div class="role-columns">
                <div class="role-card">
                  <h3>Student B · Presenter</h3>
                  <ul>
                    <li>"The project will begin in <strong>June</strong>."</li>
                    <li>"We'll be working mainly with <strong>textile weavers</strong>."</li>
                    <li>"The main goal is to improve their <strong>packaging</strong>."</li>
                  </ul>
                </div>
                <div class="role-card">
                  <h3>Student A · Project Lead</h3>
                  <ul>
                    <li>Start Date: <strong>July</strong></li>
                    <li>Focus Group: <strong>All artisans</strong></li>
                    <li>Goal: Improve <strong>digital marketing</strong></li>
                  </ul>
                </div>
              </div>
              <p class="hint">Answer in full sentences and stress the new data so it is unmistakably clear.</p>
            </div>
          </div>
        </div>

        <!-- Slide 14 -->
        <div class="slide-stage hidden section-break full-width-bg">
          <div class="bg-media" style="background-image: url('https://images.pexels.com/photos/3184306/pexels-photo-3184306.jpeg?auto=compress&cs=tinysrgb&fit=crop&w=1920&h=1080');" role="presentation" aria-hidden="true"></div>
          <div class="img-overlay" style="background: linear-gradient(140deg, rgba(12,28,18,0.45) 0%, rgba(12,28,18,0.25) 40%, rgba(12,28,18,0.3) 100%);"></div>
          <div class="slide-inner">
            <div class="bg-content centered">
              <div class="overlay-card centered" style="max-width: 520px;">
                <span class="pill overlay-pill"><i class="fa-solid fa-star"></i> Task</span>
                <h2>Task Introduction</h2>
                <p class="deck-subtitle">Take a breath, reset your focus, and get ready to design the pilot program.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 15 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-info-circle"></i> Task Context</span>
            <h2>The Nablus Artisans Project</h2>
            <div class="card content-body">
              <p><strong>The Situation:</strong> Your NGO has analyzed the recent Nablus Artisan Market Report.</p>
              <p><strong>The Key Finding:</strong> Online sales have fallen by 20% in two years. The report identified the main cause as a lack of digital marketing skills, not poor product quality.</p>
              <p><strong>The Goal:</strong> Your team must design a 3-month "pilot program" to test a solution before launching a bigger, more expensive project.</p>
              <p><strong>The Agreed Strategy:</strong> After discussion, your management has decided on a "hybrid" approach, which will include both group workshops and one-on-one mentorship.</p>
              <p><strong>Your Role:</strong> You are the project planning team. Your job is to decide on the specific details of this pilot program.</p>
            </div>
          </div>
        </div>

        <!-- Slide 16 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-clipboard-list"></i> Task Instructions</span>
            <h2>Design the Pilot Program (15 mins)</h2>
            <div class="card" style="gap: 1rem;">
              <p>In your group, discuss and make decisions on the key details below.</p>
              <ul>
                <li>Use language from the lesson to propose ideas, justify your choices, and express concerns.</li>
                <li>Prepare a 2-minute summary of your pilot program plan to present to the class.</li>
              </ul>
              <ol style="padding-left: 1.25rem; display: flex; flex-direction: column; gap: 0.65rem;">
                <li><strong>Program Name:</strong> What is a catchy, positive name for your program?</li>
                <li><strong>Target Artisan Group:</strong> Which specific artisan group in Nablus will you target for the pilot (e.g., potters, embroiderers, olive wood carvers)? Why them?</li>
                <li><strong>Core Activities:</strong> What will be the ONE main activity for the workshops, and the ONE main activity for the mentorship?</li>
                <li><strong>Measuring Success:</strong> What is the main way you will measure if the pilot is successful?</li>
              </ol>
            </div>
          </div>
        </div>

        <!-- Slide 17 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-chalkboard-teacher"></i> Reporting</span>
            <h2>Presenting Your Pilot Program</h2>
            <div class="card" style="gap: 1rem;">
              <p>It's time to share your pilot program designs.</p>
              <ul>
                <li>One person from each group, please share the name of your program and its main goals.</li>
                <li>What was the most important reason for choosing your core activities?</li>
                <li>How will you measure the success of your pilot?</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Slide 18 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-puzzle-piece"></i> Practice Activities (Homework)</span>
            <h2>Language Practice</h2>
            <div class="card" style="gap: 1.5rem;">
              <div class="interactive-block" data-activity="mc-grammar">
                <h3><i class="fa-solid fa-spell-check" style="margin-right: 8px;"></i>Grammar: Choose the correct past perfect form.</h3>
                <div class="quiz-grid">
                  <div class="quiz-card" data-correct="had collected">
                    <p>The report used data that the team ____ earlier.</p>
                    <select>
                      <option value="">Select</option>
                      <option value="collected">collected</option>
                      <option value="had collected">had collected</option>
                    </select>
                  </div>
                  <div class="quiz-card" data-correct="had already secured">
                    <p>By the time the project started, the NGO ____ funding.</p>
                    <select>
                      <option value="">Select</option>
                      <option value="already secured">already secured</option>
                      <option value="had already secured">had already secured</option>
                    </select>
                  </div>
                  <div class="quiz-card" data-correct="hadn't known">
                    <p>She ____ about the issue before she read the report.</p>
                    <select>
                      <option value="">Select</option>
                      <option value="didn't know">didn't know</option>
                      <option value="hadn't known">hadn't known</option>
                    </select>
                  </div>
                  <div class="quiz-card" data-correct="had completed">
                    <p>After they ____ the pilot, they analyzed the results.</p>
                    <select>
                      <option value="">Select</option>
                      <option value="completed">completed</option>
                      <option value="had completed">had completed</option>
                    </select>
                  </div>
                  <div class="quiz-card" data-correct="had consulted">
                    <p>They ____ the artisan cooperative before they designed the program.</p>
                    <select>
                      <option value="">Select</option>
                      <option value="consulted">consulted</option>
                      <option value="had consulted">had consulted</option>
                    </select>
                  </div>
                </div>
                <div class="activity-actions">
                  <button class="activity-btn secondary" type="button" data-action="reset">Reset</button>
                  <button class="activity-btn" type="button" data-action="check">Check</button>
                </div>
                <div class="feedback-msg" aria-live="polite"></div>
              </div>
              <div class="interactive-block" data-activity="matching-vocab">
                <div class="matching-card">
                  <h3><i class="fa-solid fa-language" style="margin-right: 8px;"></i>Vocabulary: Match the term to its meaning.</h3>
                  <p class="hint">Select the best term from the menu for each definition.</p>
                  <div class="matching-stack">
                    <div class="matching-option" data-correct="Sustainability"><span>The ability to continue long-term without depleting resources.</span><select><option value="">Select term</option><option value="Sustainability">Sustainability</option><option value="Pilot Program">Pilot Program</option><option value="Stakeholder">Stakeholder</option><option value="Digital Literacy">Digital Literacy</option><option value="E-commerce">E-commerce</option></select></div>
                    <div class="matching-option" data-correct="Pilot Program"><span>A small-scale preliminary study to evaluate if an idea will work.</span><select><option value="">Select term</option><option value="Sustainability">Sustainability</option><option value="Pilot Program">Pilot Program</option><option value="Stakeholder">Stakeholder</option><option value="Digital Literacy">Digital Literacy</option><option value="E-commerce">E-commerce</option></select></div>
                    <div class="matching-option" data-correct="Stakeholder"><span>A person or group with an interest or concern in a project.</span><select><option value="">Select term</option><option value="Sustainability">Sustainability</option><option value="Pilot Program">Pilot Program</option><option value="Stakeholder">Stakeholder</option><option value="Digital Literacy">Digital Literacy</option><option value="E-commerce">E-commerce</option></select></div>
                    <div class="matching-option" data-correct="Digital Literacy"><span>The ability to use information and communication technologies.</span><select><option value="">Select term</option><option value="Sustainability">Sustainability</option><option value="Pilot Program">Pilot Program</option><option value="Stakeholder">Stakeholder</option><option value="Digital Literacy">Digital Literacy</option><option value="E-commerce">E-commerce</option></select></div>
                    <div class="matching-option" data-correct="E-commerce"><span>The buying and selling of goods or services using the internet.</span><select><option value="">Select term</option><option value="Sustainability">Sustainability</option><option value="Pilot Program">Pilot Program</option><option value="Stakeholder">Stakeholder</option><option value="Digital Literacy">Digital Literacy</option><option value="E-commerce">E-commerce</option></select></div>
                  </div>
                </div>
                <div class="activity-actions">
                  <button class="activity-btn secondary" type="button" data-action="reset">Reset</button>
                  <button class="activity-btn" type="button" data-action="check">Check</button>
                </div>
                <div class="feedback-msg" aria-live="polite"></div>
              </div>

              <div class="card" style="gap: 1rem;" data-activity="click-drop">
                <h3><i class="fa-solid fa-arrows-left-right"></i>Prepositions: Click a word and then the sentence slot where it belongs.</h3>
                <ol class="click-drop-sentences">
                  <li>The report focused <button type="button" class="drop-zone placeholder" data-answer="on" data-placeholder="Select" aria-label="Sentence 1"></button> the challenges for artisans.</li>
                  <li>We need to invest <button type="button" class="drop-zone placeholder" data-answer="in" data-placeholder="Select" aria-label="Sentence 2"></button> new training materials.</li>
                  <li>We must consult <button type="button" class="drop-zone placeholder" data-answer="with" data-placeholder="Select" aria-label="Sentence 3"></button> local artisans before starting.</li>
                  <li>The success of the project depends <button type="button" class="drop-zone placeholder" data-answer="on" data-placeholder="Select" aria-label="Sentence 4"></button> community participation.</li>
                  <li>This program is aimed <button type="button" class="drop-zone placeholder" data-answer="at" data-placeholder="Select" aria-label="Sentence 5"></button> improving economic outcomes.</li>
                </ol>
                <div class="token-bank" aria-label="Preposition options">
                  <button type="button" class="click-token" data-value="on" data-token-id="prep-token-1">on</button>
                  <button type="button" class="click-token" data-value="in" data-token-id="prep-token-2">in</button>
                  <button type="button" class="click-token" data-value="with" data-token-id="prep-token-3">with</button>
                  <button type="button" class="click-token" data-value="on" data-token-id="prep-token-4">on</button>
                  <button type="button" class="click-token" data-value="at" data-token-id="prep-token-5">at</button>
                </div>
                <div class="activity-actions">
                  <button class="activity-btn secondary" type="button" data-action="reset">Reset</button>
                  <button class="activity-btn" type="button" data-action="check">Check</button>
                </div>
                <div class="feedback-msg" aria-live="polite"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Slide 19 -->
        <div class="slide-stage hidden">
          <div class="slide-inner">
            <span class="pill"><i class="fa-solid fa-pen-fancy"></i> Reflection</span>
            <h2>Looking Back</h2>
            <div class="card">
              <p>In the chatbox, please answer the following questions:</p>
              <ul class="reflection-list">
                <li><strong>3 Things I Learned:</strong> Name three key takeaways from today's session.</li>
                <li><strong>2 Things I Found Interesting:</strong> Share two points or ideas that caught your attention.</li>
                <li><strong>1 Question I Still Have:</strong> What is one question you still have about strategic planning or the language we practiced?</li>
              </ul>
            </div>
          </div>
        </div>
        <button class="slide-nav slide-nav-prev" aria-label="Previous Slide"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="slide-nav slide-nav-next" aria-label="Next Slide"><i class="fa-solid fa-chevron-right"></i></button>
      </div>
    </main>
  </div>

  <script type="module">
    const stageViewport = document.querySelector('.stage-viewport');
    const nextBtn = stageViewport?.querySelector('.slide-nav-next');
    const prevBtn = stageViewport?.querySelector('.slide-nav-prev');
    const counter = document.getElementById('slide-counter');
    const addSlideBtn = document.getElementById('add-slide-btn');
    const saveStateBtn = document.getElementById('save-state-btn');
    const loadStateBtn = document.getElementById('load-state-btn');
    const loadStateInput = document.getElementById('load-state-input');
    const highlightBtn = document.getElementById('highlight-btn');
    const highlightColorSelect = document.getElementById('highlight-color');
    const removeHighlightBtn = document.getElementById('remove-highlight-btn');

    const REMOTE_IMAGE_SELECTOR = 'img[data-remote-src]';
    const remoteImageHydrations = new WeakMap();

    function getRemoteImageContainer(img) {
      if (!(img instanceof HTMLElement)) {
        return null;
      }
      return img.closest('.bg-media') ?? img.closest('.context-image') ?? img.parentElement;
    }

    function applyRemoteImageFallback(img, error) {
      if (error) {
        console.warn(
          `Falling back to a gradient background for remote image: ${img?.dataset?.remoteSrc ?? 'unknown'}`,
          error,
        );
      }
      const container = getRemoteImageContainer(img);
      if (container) {
        container.classList.add('remote-image-fallback');
      }
      img.dataset.remoteHydrated = 'failed';
    }

    async function hydrateRemoteImage(img) {
      if (!(img instanceof HTMLImageElement)) {
        return;
      }

      const remoteSrc = img.dataset.remoteSrc;
      if (!remoteSrc) {
        return;
      }

      if (typeof fetch !== 'function') {
        applyRemoteImageFallback(img, new Error('Fetch API is unavailable'));
        return;
      }

      const hydrationState = img.dataset.remoteHydrated;
      if (hydrationState === 'success' || hydrationState === 'failed') {
        return;
      }

      if (remoteImageHydrations.has(img)) {
        return remoteImageHydrations.get(img);
      }

      const hydrationPromise = (async () => {
        try {
          await new Promise((resolve, reject) => {
            function cleanup() {
              img.removeEventListener('load', handleLoad);
              img.removeEventListener('error', handleError);
            }

            function handleLoad() {
              cleanup();
              resolve();
            }

            function handleError(err) {
              cleanup();
              reject(new Error('Image failed to load from src', { cause: err }));
            }

            img.addEventListener('load', handleLoad, { once: true });
            img.addEventListener('error', handleError, { once: true });
            img.removeAttribute('loading');
            img.src = remoteSrc;
          });

          img.dataset.remoteHydrated = 'success';
        } catch (error) {
          applyRemoteImageFallback(img, error);
        } finally {
          remoteImageHydrations.delete(img);
        }
      })();

      remoteImageHydrations.set(img, hydrationPromise);
      return hydrationPromise;
    }

    async function hydrateRemoteImages(root = document) {
      if (!root) {
        return;
      }

      const scope = root instanceof Element || root instanceof Document ? root : document;
      const queryFn = typeof scope.querySelectorAll === 'function' ? scope.querySelectorAll.bind(scope) : null;
      const remoteImages = queryFn ? Array.from(queryFn(REMOTE_IMAGE_SELECTOR)) : [];

      if (!remoteImages.length) {
        return;
      }

      await Promise.all(
        remoteImages.map((img) => {
          const hydration = hydrateRemoteImage(img);
          if (hydration && typeof hydration.then === 'function') {
            return hydration.catch((error) => {
              console.warn('Remote image hydration failed', error);
            });
          }
          return undefined;
        }),
      );
    }

    let slides = [];
    let currentSlideIndex = 0;
    let mindMapId = 0;

    function refreshSlides() {
      slides = Array.from(stageViewport?.querySelectorAll('.slide-stage') ?? []);
    }

    function updateCounter() {
      if (!counter) return;
      const total = slides.length;
      const current = total ? currentSlideIndex + 1 : 0;
      counter.textContent = `${current} / ${total}`;
    }

    function showSlide(index) {
      if (!slides.length) return;
      currentSlideIndex = (index + slides.length) % slides.length;
      slides.forEach((slide, slideIndex) => {
        slide.classList.toggle('hidden', slideIndex !== currentSlideIndex);
      });
      updateCounter();
    }

    function navigate(direction) {
      showSlide(currentSlideIndex + direction);
    }

    function setupNavigation() {
      nextBtn?.addEventListener('click', () => navigate(1));
      prevBtn?.addEventListener('click', () => navigate(-1));

      document.addEventListener('keydown', (event) => {
        const target = event.target;
        if (target instanceof HTMLElement) {
          if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {
            return;
          }
        }
        if (event.key === 'ArrowRight') {
          event.preventDefault();
          navigate(1);
        }
        if (event.key === 'ArrowLeft') {
          event.preventDefault();
          navigate(-1);
        }
      });
    }

    function addBlankSlide() {
      if (!stageViewport) return;
      const newSlide = createBlankSlide();
      const insertionPoint = prevBtn ?? nextBtn ?? null;
      stageViewport.insertBefore(newSlide, insertionPoint);
      attachBlankSlideEvents(newSlide);
      refreshSlides();
      showSlide(slides.length - 1);
    }

    function createBlankSlide() {
      const slide = document.createElement('div');
      slide.className = 'slide-stage hidden';
      slide.dataset.type = 'blank';
      slide.innerHTML = `
    <div class="slide-inner">
      <div class="blank-slide">
        <div class="blank-controls">
          <button class="activity-btn" type="button" data-action="add-textbox">
            <i class="fa-solid fa-pen-to-square"></i>
            Add Textbox
          </button>
          <button class="activity-btn secondary" type="button" data-action="add-mindmap">
            <i class="fa-solid fa-diagram-project"></i>
            Add Mind Map
          </button>
        </div>
        <p class="blank-hint" data-role="hint">Add textboxes for free typing or build a mind map to capture relationships.</p>
        <div class="blank-canvas" role="region" aria-label="Blank slide workspace"></div>
      </div>
    </div>
  `;
      return slide;
    }

    function attachBlankSlideEvents(slide) {
      const canvas = slide.querySelector('.blank-canvas');
      const hint = slide.querySelector('[data-role="hint"]');
      const addTextboxBtn = slide.querySelector('[data-action="add-textbox"]');
      const addMindmapBtn = slide.querySelector('[data-action="add-mindmap"]');

      if (!(canvas instanceof HTMLElement) || !(hint instanceof HTMLElement)) {
        return;
      }

      const DEFAULT_HINT = 'Add textboxes for free typing or build a mind map to capture relationships.';
      const TEXTBOX_HINT = 'Drag your textboxes into place and double-click to edit the content.';
      const MINDMAP_HINT = 'Mind map ready. Add branches to capture ideas and connections.';

      function updateHintForCanvas() {
        if (!(hint instanceof HTMLElement)) return;
        if (canvas.querySelector('.mindmap')) {
          hint.textContent = MINDMAP_HINT;
        } else if (canvas.querySelector('.textbox')) {
          hint.textContent = TEXTBOX_HINT;
        } else {
          hint.textContent = DEFAULT_HINT;
        }
      }

      addTextboxBtn?.addEventListener('click', () => {
        const textbox = createTextbox({ onRemove: updateHintForCanvas });
        canvas.appendChild(textbox);
        positionTextbox(textbox, canvas);
        updateHintForCanvas();
      });

      addMindmapBtn?.addEventListener('click', () => {
        if (canvas.querySelector('.mindmap')) {
          const existing = canvas.querySelector('.mindmap');
          existing?.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }
        const mindmap = createMindMap(() => {
          updateHintForCanvas();
        });
        initialiseMindMap(mindmap, { onRemove: updateHintForCanvas });
        canvas.appendChild(mindmap);
        updateHintForCanvas();
      });

      canvas
        .querySelectorAll('.textbox')
        .forEach((textbox) => initialiseTextbox(textbox, { onRemove: updateHintForCanvas }));

      canvas
        .querySelectorAll('.mindmap')
        .forEach((mindmap) => initialiseMindMap(mindmap, { onRemove: updateHintForCanvas }));

      updateHintForCanvas();
    }

    function positionTextbox(textbox, canvas) {
      const count = canvas.querySelectorAll('.textbox').length - 1;
      const offset = 24 * count;
      textbox.style.left = `${offset}px`;
      textbox.style.top = `${offset}px`;
    }

    function createTextbox({ onRemove } = {}) {
      const textbox = document.createElement('div');
      textbox.className = 'textbox';
      textbox.innerHTML = `
    <button type="button" class="textbox-remove" aria-label="Remove textbox">
      <i class="fa-solid fa-xmark"></i>
    </button>
    <div class="textbox-handle">Textbox</div>
    <div class="textbox-body" contenteditable="true" aria-label="Editable textbox">Double-click to start typing...</div>
  `;
      initialiseTextbox(textbox, { onRemove });
      return textbox;
    }

    function initialiseTextbox(textbox, { onRemove } = {}) {
      if (!(textbox instanceof HTMLElement)) {
        return textbox;
      }

      textbox.__deckTextboxOnRemove = onRemove;
      if (textbox.__deckTextboxInitialised) {
        return textbox;
      }
      textbox.__deckTextboxInitialised = true;

      const removeBtn = textbox.querySelector('.textbox-remove');
      removeBtn?.addEventListener('click', () => {
        textbox.remove();
        if (typeof textbox.__deckTextboxOnRemove === 'function') {
          textbox.__deckTextboxOnRemove();
        }
      });

      const body = textbox.querySelector('.textbox-body');
      body?.addEventListener('dblclick', () => {
        if (body instanceof HTMLElement) {
          body.focus();
        }
      });

      makeDraggable(textbox);
      return textbox;
    }

    function makeDraggable(element) {
      if (!(element instanceof HTMLElement)) return;
      if (element.__deckDraggableInitialised) {
        return;
      }
      element.__deckDraggableInitialised = true;

      const handle = element.querySelector('.textbox-handle') ?? element;
      let pointerId = null;
      let offsetX = 0;
      let offsetY = 0;

      handle.addEventListener('pointerdown', (event) => {
        const canvas = element.parentElement;
        if (!(canvas instanceof HTMLElement)) return;
        pointerId = event.pointerId;
        try {
          element.setPointerCapture(pointerId);
        } catch (error) {
          // ignore when pointer capture is not supported
        }
        const elementRect = element.getBoundingClientRect();
        offsetX = event.clientX - elementRect.left;
        offsetY = event.clientY - elementRect.top;
        element.dataset.dragging = 'true';
        event.preventDefault();
      });

      element.addEventListener('pointermove', (event) => {
        if (element.dataset.dragging !== 'true' || event.pointerId !== pointerId) return;
        const canvas = element.parentElement;
        if (!(canvas instanceof HTMLElement)) return;
        const canvasRect = canvas.getBoundingClientRect();
        const rawX = event.clientX - canvasRect.left + canvas.scrollLeft - offsetX;
        const rawY = event.clientY - canvasRect.top + canvas.scrollTop - offsetY;
        const maxX = Math.max(0, canvas.scrollWidth - element.offsetWidth);
        const maxY = Math.max(0, canvas.scrollHeight - element.offsetHeight);
        const clampedX = Math.min(Math.max(0, rawX), maxX);
        const clampedY = Math.min(Math.max(0, rawY), maxY);
        element.style.left = `${clampedX}px`;
        element.style.top = `${clampedY}px`;
      });

      function clearPointerState(event) {
        if (event.pointerId !== pointerId) return;
        delete element.dataset.dragging;
        if (pointerId !== null) {
          try {
            element.releasePointerCapture(pointerId);
          } catch (error) {
            // ignore release errors when pointer capture is not active
          }
        }
        pointerId = null;
      }

      element.addEventListener('pointerup', clearPointerState);
      element.addEventListener('pointercancel', clearPointerState);
    }

    function createMindMap(onRemove) {
      const container = document.createElement('section');
      container.className = 'mindmap';
      const branchInputId = `mindmap-branch-${++mindMapId}`;
      container.innerHTML = `
    <div class="mindmap-header">
      <h3 class="mindmap-title">Mind Map</h3>
      <button type="button" class="mindmap-remove">
        <i class="fa-solid fa-trash-can"></i>
        Remove
      </button>
    </div>
    <div class="mindmap-center" contenteditable="true" role="textbox" aria-label="Mind map central idea">Central idea</div>
    <div class="mindmap-branches" aria-live="polite"></div>
    <form class="mindmap-form">
      <label class="sr-only" for="${branchInputId}">New branch label</label>
      <input id="${branchInputId}" type="text" placeholder="Add branch idea" autocomplete="off">
      <button type="submit">
        <i class="fa-solid fa-plus"></i>
        Add Branch
      </button>
    </form>
  `;
      const branches = container.querySelector('.mindmap-branches');
      if (branches && !branches.querySelector('.mindmap-branch')) {
        const defaultBranch = createMindMapBranch('Add supporting detail...');
        branches.appendChild(defaultBranch);
      }

      initialiseMindMap(container, { onRemove });
      return container;
    }

    function initialiseMindMap(container, { onRemove } = {}) {
      if (!(container instanceof HTMLElement)) {
        return container;
      }

      container.__deckMindmapOnRemove = onRemove;
      if (!container.__deckMindmapInitialised) {
        container.__deckMindmapInitialised = true;
        const removeBtn = container.querySelector('.mindmap-remove');
        removeBtn?.addEventListener('click', () => {
          container.remove();
          if (typeof container.__deckMindmapOnRemove === 'function') {
            container.__deckMindmapOnRemove();
          }
        });
      }

      const form = container.querySelector('.mindmap-form');
      const input = container.querySelector('.mindmap-form input');
      const branches = container.querySelector('.mindmap-branches');

      if (form && !form.__deckSubmitInitialised) {
        form.__deckSubmitInitialised = true;
        form.addEventListener('submit', (event) => {
          event.preventDefault();
          if (!branches || !input) return;
          const value = input.value.trim();
          if (!value) return;
          const newBranch = createMindMapBranch(value);
          branches.appendChild(newBranch);
          initialiseMindMapBranch(newBranch);
          input.value = '';
          input.focus();
        });
      }

      container
        .querySelectorAll('.mindmap-branch')
        .forEach((branch) => initialiseMindMapBranch(branch));

      return container;
    }

    function createMindMapBranch(text) {
      const branch = document.createElement('div');
      branch.className = 'mindmap-branch';
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.setAttribute('aria-label', 'Mind map branch');
      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'branch-remove';
      removeBtn.textContent = 'Remove';
      branch.append(textarea, removeBtn);
      initialiseMindMapBranch(branch);
      return branch;
    }

    function initialiseMindMapBranch(branch) {
      if (!(branch instanceof HTMLElement)) {
        return branch;
      }

      if (branch.__deckMindmapBranchInitialised) {
        return branch;
      }
      branch.__deckMindmapBranchInitialised = true;
      const removeBtn = branch.querySelector('.branch-remove');
      removeBtn?.addEventListener('click', () => {
        branch.remove();
      });
      return branch;
    }

    function recalibrateMindMapCounter() {
      if (!stageViewport) return;
      const inputs = stageViewport.querySelectorAll('.mindmap-form input[id^="mindmap-branch-"]');
      inputs.forEach((input) => {
        if (!(input instanceof HTMLInputElement)) return;
        const match = input.id.match(/mindmap-branch-(\d+)/);
        if (match) {
          const value = Number.parseInt(match[1], 10);
          if (!Number.isNaN(value)) {
            mindMapId = Math.max(mindMapId, value);
          }
        }
      });
    }

    function getDeckState() {
      refreshSlides();
      return {
        version: 1,
        currentSlideIndex,
        slides: slides.map((slide) => slide.outerHTML),
      };
    }

    function downloadDeckState() {
      try {
        const state = getDeckState();
        const blob = new Blob([JSON.stringify(state, null, 2)], {
          type: 'application/json',
        });
        const url = URL.createObjectURL(blob);
        const anchor = document.createElement('a');
        anchor.href = url;
        anchor.download = 'deck-state.json';
        anchor.click();
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('Failed to save deck state', error);
        window.alert("Sorry, we couldn't save the deck right now. Please try again.");
      }
    }

    function parseDeckState(raw) {
      const parsed = JSON.parse(raw);
      if (!parsed || typeof parsed !== 'object' || !Array.isArray(parsed.slides)) {
        throw new Error('Invalid deck state structure');
      }
      return parsed;
    }

    function applyDeckState(state) {
      if (!stageViewport || !state || !Array.isArray(state.slides)) {
        throw new Error('Deck state does not include slides');
      }

      const navButtons = Array.from(stageViewport.querySelectorAll('.slide-nav'));
      const fragment = document.createDocumentFragment();

      state.slides.forEach((slideHTML) => {
        if (typeof slideHTML !== 'string') {
          return;
        }
        const template = document.createElement('template');
        template.innerHTML = slideHTML.trim();
        const slide = template.content.firstElementChild;
        if (slide instanceof HTMLElement && slide.classList.contains('slide-stage')) {
          fragment.appendChild(slide);
        }
      });

      stageViewport.innerHTML = '';
      stageViewport.appendChild(fragment);
      navButtons.forEach((button) => stageViewport.appendChild(button));

      refreshSlides();
      slides
        .filter((slide) => slide.dataset.type === 'blank')
        .forEach((slide) => attachBlankSlideEvents(slide));

      initialiseActivities();
      recalibrateMindMapCounter();

      if (slides.length) {
        const requestedIndex =
          typeof state.currentSlideIndex === 'number'
            ? Math.min(Math.max(state.currentSlideIndex, 0), slides.length - 1)
            : 0;
        showSlide(requestedIndex);
      } else {
        updateCounter();
      }

      hydrateRemoteImages(stageViewport).catch((error) => {
        console.warn('Remote image hydration failed after loading state', error);
      });
    }

    function handleStateFileSelection(event) {
      const input = event.target;
      if (!(input instanceof HTMLInputElement) || !input.files?.length) {
        return;
      }

      const [file] = input.files;
      const reader = new FileReader();

      reader.addEventListener('load', () => {
        try {
          const text = typeof reader.result === 'string' ? reader.result : '';
          const state = parseDeckState(text);
          applyDeckState(state);
        } catch (error) {
          console.error('Failed to load deck state', error);
          window.alert('The selected file could not be loaded. Please choose a valid deck state JSON file.');
        } finally {
          input.value = '';
        }
      });

      reader.addEventListener('error', () => {
        console.error('Failed to read deck state file', reader.error);
        window.alert('We could not read that file. Please try again with a different JSON file.');
        input.value = '';
      });

      reader.readAsText(file);
    }

    function findSlideForNode(node) {
      if (!node) return null;
      if (node instanceof HTMLElement) {
        return node.closest('.slide-stage');
      }
      if (node instanceof Text) {
        return node.parentElement?.closest('.slide-stage') ?? null;
      }
      return null;
    }

    function applyHighlight(color) {
      const selection = window.getSelection();
      if (!selection || selection.rangeCount === 0 || selection.isCollapsed) {
        window.alert('Select some text in a slide before applying a highlight.');
        return;
      }

      const range = selection.getRangeAt(0);
      const startSlide = findSlideForNode(range.startContainer);
      const endSlide = findSlideForNode(range.endContainer);

      if (!startSlide || !endSlide || startSlide !== endSlide) {
        window.alert('Highlights must stay within a single slide.');
        return;
      }

      if (!stageViewport?.contains(startSlide)) {
        window.alert('Please highlight text within the slide area.');
        return;
      }

      try {
        const contents = range.extractContents();
        const textSample = contents.textContent?.trim();
        if (!textSample) {
          window.alert('Select some text to highlight first.');
          range.insertNode(contents);
          return;
        }

        const highlight = document.createElement('mark');
        highlight.className = 'text-highlight';
        highlight.dataset.color = color;
        highlight.style.setProperty('--highlight-color', color);
        highlight.appendChild(contents);
        range.insertNode(highlight);

        selection.removeAllRanges();
        const newRange = document.createRange();
        newRange.selectNodeContents(highlight);
        selection.addRange(newRange);
      } catch (error) {
        console.error('Failed to apply highlight', error);
        window.alert("Sorry, that selection couldn't be highlighted. Try selecting a smaller section of text.");
      }
    }

    function removeHighlight() {
      const selection = window.getSelection();
      if (!selection || selection.rangeCount === 0) {
        window.alert('Place your cursor inside a highlight to clear it.');
        return;
      }

      let container = selection.anchorNode;
      if (container instanceof Text) {
        container = container.parentElement;
      }

      const highlight = container instanceof HTMLElement ? container.closest('.text-highlight') : null;

      if (!highlight || !stageViewport?.contains(highlight)) {
        window.alert('Place your cursor inside a highlight to clear it.');
        return;
      }

      const parent = highlight.parentNode;
      if (!parent) {
        return;
      }

      while (highlight.firstChild) {
        parent.insertBefore(highlight.firstChild, highlight);
      }
      highlight.remove();
      if (parent instanceof HTMLElement) {
        parent.normalize();
      }
      selection.removeAllRanges();
    }

    function setupMatching(activityEl) {
      const options = Array.from(activityEl.querySelectorAll('.matching-option'));
      const feedback = activityEl.querySelector('.feedback-msg');
      const buttons = activityEl.querySelectorAll('.activity-actions button');
      if (!feedback) return;

      buttons.forEach((btn) => {
        if (btn.dataset.action === 'check') {
          btn.addEventListener('click', () => {
            let correctCount = 0;
            options.forEach((option) => {
              const select = option.querySelector('select');
              const isCorrect = select?.value === option.dataset.correct;
              option.style.borderColor = isCorrect ? '#2E7D32' : '#C62828';
              option.style.background = isCorrect
                ? 'rgba(46,125,50,0.12)'
                : 'rgba(198,40,40,0.12)';
              if (isCorrect) correctCount += 1;
            });
            if (correctCount === options.length) {
              feedback.textContent = 'Excellent! Every match is correct.';
              feedback.className = 'feedback-msg success';
            } else {
              feedback.textContent = `You have ${correctCount} / ${options.length} correct. Adjust and try again.`;
              feedback.className = 'feedback-msg error';
            }
          });
        } else if (btn.dataset.action === 'reset') {
          btn.addEventListener('click', () => {
            options.forEach((option) => {
              const select = option.querySelector('select');
              if (select) {
                select.value = '';
              }
              option.style.borderColor = 'rgba(122,132,113,0.16)';
              option.style.background = 'color-mix(in srgb, var(--warm-cream) 60%, transparent)';
            });
            feedback.textContent = '';
            feedback.className = 'feedback-msg';
          });
        }
      });
    }

    function setupMcGrammar(activityEl) {
      const cards = Array.from(activityEl.querySelectorAll('.quiz-card'));
      const feedback = activityEl.querySelector('.feedback-msg');
      const buttons = activityEl.querySelectorAll('.activity-actions button');
      if (!feedback) return;

      buttons.forEach((btn) => {
        if (btn.dataset.action === 'check') {
          btn.addEventListener('click', () => {
            let correctCount = 0;
            cards.forEach((card) => {
              const select = card.querySelector('select');
              const isCorrect = select?.value === card.dataset.correct;
              card.style.borderColor = isCorrect ? '#2E7D32' : '#C62828';
              card.style.background = isCorrect ? 'rgba(46,125,50,0.12)' : 'rgba(198,40,40,0.12)';
              if (isCorrect) correctCount += 1;
            });
            if (correctCount === cards.length) {
              feedback.textContent = 'Great job! All answers are correct.';
              feedback.className = 'feedback-msg success';
            } else {
              feedback.textContent = `You have ${correctCount} / ${cards.length} correct answers.`;
              feedback.className = 'feedback-msg error';
            }
          });
        } else if (btn.dataset.action === 'reset') {
          btn.addEventListener('click', () => {
            cards.forEach((card) => {
              const select = card.querySelector('select');
              if (select) {
                select.value = '';
              }
              card.style.borderColor = 'rgba(122,132,113,0.2)';
              card.style.background = 'var(--soft-white)';
            });
            feedback.textContent = '';
            feedback.className = 'feedback-msg';
          });
        }
      });
    }

    function setupMcQuiz(activityEl) {
      const cards = Array.from(activityEl.querySelectorAll('.quiz-card'));
      const feedback = activityEl.querySelector('.feedback-msg');
      const buttons = activityEl.querySelectorAll('.activity-actions button');
      if (!feedback) return;

      buttons.forEach((btn) => {
        if (btn.dataset.action === 'check') {
          btn.addEventListener('click', () => {
            let correctCount = 0;
            cards.forEach((card) => {
              const options = Array.from(card.querySelectorAll('.quiz-option'));
              const selected = options.find((option) => option.querySelector('input')?.checked);
              options.forEach((option) => option.classList.remove('correct', 'incorrect'));
              if (selected) {
                const input = selected.querySelector('input');
                const value = input?.value;
                const isCorrect = value === card.dataset.correct;
                selected.classList.add(isCorrect ? 'correct' : 'incorrect');
                if (isCorrect) correctCount += 1;
              }
            });
            if (correctCount === cards.length) {
              feedback.textContent = 'Brilliant listening! All answers correct.';
              feedback.className = 'feedback-msg success';
            } else {
              feedback.textContent = `You have ${correctCount} / ${cards.length} correct. Review the audio and try again.`;
              feedback.className = 'feedback-msg error';
            }
          });
        } else if (btn.dataset.action === 'reset') {
          btn.addEventListener('click', () => {
            cards.forEach((card) => {
              const options = Array.from(card.querySelectorAll('.quiz-option'));
              options.forEach((option) => {
                const input = option.querySelector('input');
                if (input) {
                  input.checked = false;
                }
                option.classList.remove('correct', 'incorrect');
              });
            });
            feedback.textContent = '';
            feedback.className = 'feedback-msg';
          });
        }
      });
    }

    function setupClickPlacement(activityEl) {
      const tokens = Array.from(activityEl.querySelectorAll('.click-token'));
      const dropZones = Array.from(activityEl.querySelectorAll('.drop-zone'));
      const feedback = activityEl.querySelector('.feedback-msg');
      const buttons = Array.from(activityEl.querySelectorAll('.activity-actions button'));
      let activeToken = null;

      dropZones.forEach((zone, index) => {
        if (!zone.dataset.zoneId) {
          zone.dataset.zoneId = `${activityEl.dataset.activity || 'zone'}-${index + 1}-${Math.random()
            .toString(16)
            .slice(2, 6)}`;
        }
        if (!zone.dataset.placeholder) {
          zone.dataset.placeholder = 'Select';
        }
        zone.innerHTML = zone.dataset.placeholder;
        zone.classList.add('placeholder');
        zone.classList.remove('filled');

        zone.addEventListener('click', () => {
          if (activeToken) {
            const previousTokenId = zone.dataset.current;
            if (previousTokenId) {
              const previousToken = tokens.find((token) => token.dataset.tokenId === previousTokenId);
              if (previousToken) {
                previousToken.dataset.assigned = 'false';
                previousToken.dataset.zoneId = '';
                previousToken.classList.remove('used');
              }
            }

            zone.dataset.current = activeToken.dataset.tokenId;
            zone.innerHTML = activeToken.innerHTML;
            zone.classList.remove('placeholder', 'correct', 'incorrect', 'selected');
            zone.classList.add('filled');

            activeToken.dataset.assigned = 'true';
            activeToken.dataset.zoneId = zone.dataset.zoneId;
            activeToken.classList.remove('selected');
            activeToken.classList.add('used');
            activeToken = null;
          } else if (zone.dataset.current) {
            const assignedToken = tokens.find((token) => token.dataset.tokenId === zone.dataset.current);
            if (assignedToken) {
              assignedToken.dataset.assigned = 'false';
              assignedToken.dataset.zoneId = '';
              assignedToken.classList.remove('used');
            }
            zone.dataset.current = '';
            zone.innerHTML = zone.dataset.placeholder;
            zone.classList.remove('filled', 'correct', 'incorrect', 'selected');
            zone.classList.add('placeholder');
          } else {
            zone.classList.add('selected');
            window.setTimeout(() => zone.classList.remove('selected'), 200);
          }
        });
      });

      tokens.forEach((token, index) => {
        if (!token.dataset.tokenId) {
          token.dataset.tokenId = `token-${index}-${Math.random().toString(16).slice(2, 6)}`;
        }

        token.addEventListener('click', () => {
          if (token.dataset.assigned === 'true' && token.dataset.zoneId) {
            const zone = dropZones.find((item) => item.dataset.zoneId === token.dataset.zoneId);
            if (zone) {
              zone.dataset.current = '';
              zone.innerHTML = zone.dataset.placeholder;
              zone.classList.remove('filled', 'correct', 'incorrect', 'selected');
              zone.classList.add('placeholder');
            }
            token.dataset.assigned = 'false';
            token.dataset.zoneId = '';
            token.classList.remove('used');
          }

          if (activeToken === token) {
            token.classList.remove('selected');
            activeToken = null;
          } else {
            tokens.forEach((item) => item.classList.remove('selected'));
            token.classList.add('selected');
            activeToken = token;
          }
        });
      });

      buttons.forEach((btn) => {
        if (btn.dataset.action === 'check') {
          btn.addEventListener('click', () => {
            let correctCount = 0;
            dropZones.forEach((zone) => {
              const tokenId = zone.dataset.current;
              const assignedToken = tokens.find((token) => token.dataset.tokenId === tokenId);
              const selectedValue = assignedToken ? assignedToken.dataset.value || assignedToken.textContent.trim() : '';
              const isCorrect = !!tokenId && selectedValue === zone.dataset.answer;

              zone.classList.toggle('correct', isCorrect);
              zone.classList.toggle('incorrect', !!tokenId && !isCorrect);

              if (!tokenId) {
                zone.classList.remove('correct', 'incorrect');
              }

              if (isCorrect) {
                correctCount += 1;
              }
            });

            if (feedback) {
              if (correctCount === dropZones.length) {
                feedback.textContent = 'Perfect! Every response is accurate.';
                feedback.className = 'feedback-msg success';
              } else {
                feedback.textContent = `You have ${correctCount} / ${dropZones.length} correct. Adjust your choices and try again.`;
                feedback.className = 'feedback-msg error';
              }
            }
          });
        } else if (btn.dataset.action === 'reset') {
          btn.addEventListener('click', () => {
            dropZones.forEach((zone) => {
              zone.dataset.current = '';
              zone.innerHTML = zone.dataset.placeholder;
              zone.classList.remove('filled', 'correct', 'incorrect', 'selected');
              zone.classList.add('placeholder');
            });

            tokens.forEach((token) => {
              token.dataset.assigned = 'false';
              token.dataset.zoneId = '';
              token.classList.remove('selected', 'used');
            });

            activeToken = null;

            if (feedback) {
              feedback.textContent = '';
              feedback.className = 'feedback-msg';
            }
          });
        }
      });
    }

    function initialiseActivities() {
      document
        .querySelectorAll('[data-activity="matching-vocab"]')
        .forEach((el) => setupMatching(el));
      document
        .querySelectorAll('[data-activity="mc-grammar"]')
        .forEach((el) => setupMcGrammar(el));
      document
        .querySelectorAll('[data-activity="mc-quiz"]')
        .forEach((el) => setupMcQuiz(el));
      document
        .querySelectorAll('[data-activity="table-completion"]')
        .forEach((el) => setupClickPlacement(el));
      document
        .querySelectorAll('[data-activity="click-drop"]')
        .forEach((el) => setupClickPlacement(el));
    }

    async function initialiseDeck() {
      await hydrateRemoteImages().catch((error) => {
        console.warn('Remote imagery could not be hydrated during initialisation', error);
      });

      refreshSlides();
      if (slides.length) {
        showSlide(0);
      }
      setupNavigation();
      updateCounter();
      initialiseActivities();
      document
        .querySelectorAll('.slide-stage[data-type="blank"]')
        .forEach((slide) => attachBlankSlideEvents(slide));
      addSlideBtn?.addEventListener('click', addBlankSlide);
      saveStateBtn?.addEventListener('click', downloadDeckState);
      loadStateBtn?.addEventListener('click', () => {
        loadStateInput?.click();
      });
      loadStateInput?.addEventListener('change', handleStateFileSelection);
      highlightBtn?.addEventListener('click', () => {
        const selectedColor = highlightColorSelect?.value || '#F9E27D';
        applyHighlight(selectedColor);
      });
      removeHighlightBtn?.addEventListener('click', () => {
        removeHighlight();
      });
      recalibrateMindMapCounter();
    }

    initialiseDeck().catch((error) => {
      console.error('Deck initialisation failed', error);
    });
  </script>
</body>
</html>
