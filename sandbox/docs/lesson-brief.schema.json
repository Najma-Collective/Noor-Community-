{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://noor.community/schemas/lesson-brief.schema.json",
  "title": "Sandbox lesson deck brief",
  "description": "Structured payload describing a Sandbox lesson deck with ordered archetype slides, icons, imagery, and module embeds.",
  "type": "object",
  "required": ["lessonMetadata", "slides"],
  "additionalProperties": false,
  "properties": {
    "lessonMetadata": {
      "type": "object",
      "required": [
        "title",
        "subtitle",
        "audience",
        "languageLevel",
        "durationMinutes",
        "themeKeywords",
        "summary"
      ],
      "additionalProperties": false,
      "properties": {
        "title": {
          "type": "string",
          "minLength": 4,
          "maxLength": 120
        },
        "subtitle": {
          "type": "string",
          "maxLength": 180
        },
        "audience": {
          "type": "string",
          "description": "Learner profile or program focus (e.g., \"Newcomer ELA cohorts\").",
          "maxLength": 140
        },
        "languageLevel": {
          "type": "string",
          "enum": [
            "A1",
            "A2",
            "B1",
            "B2",
            "C1",
            "C2",
            "Mixed"
          ]
        },
        "durationMinutes": {
          "type": "integer",
          "minimum": 15,
          "maximum": 180
        },
        "deliveryMode": {
          "type": "string",
          "enum": ["in-person", "virtual", "hybrid"],
          "default": "in-person"
        },
        "themeKeywords": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 2,
            "maxLength": 32
          },
          "minItems": 3,
          "maxItems": 6,
          "uniqueItems": true
        },
        "summary": {
          "type": "string",
          "maxLength": 480
        },
        "essentialQuestion": {
          "type": "string",
          "maxLength": 160
        },
        "standards": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 64
          },
          "maxItems": 6,
          "uniqueItems": true
        },
        "pacingNotes": {
          "type": "string",
          "maxLength": 360
        }
      }
    },
    "slides": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/slide" },
      "uniqueItems": true
    }
  },
  "$defs": {
    "faIconClass": {
      "type": "string",
      "pattern": "^fa-(solid|regular|brands) fa-[a-z0-9-]+$"
    },
    "colorToken": {
      "oneOf": [
        {
          "type": "string",
          "enum": [
            "--primary-forest",
            "--forest-shadow",
            "--deep-forest",
            "--primary-sage",
            "--secondary-sage",
            "--tertiary-sage",
            "--accent-amber",
            "--accent-rose",
            "--accent-sky",
            "--accent-lilac",
            "--ink",
            "--ink-muted",
            "--ink-subtle",
            "--soft-white",
            "--warm-cream",
            "--surface-base",
            "--surface-card",
            "--surface-muted",
            "--surface-overlay-strong",
            "--surface-overlay-light",
            "--border-sage",
            "--hover-sage",
            "--border-soft",
            "--border-strong",
            "--divider-subtle"
          ]
        },
        {
          "type": "string",
          "pattern": "^(rgba?|hsla?)\\([0-9%., ]+\\)$"
        }
      ]
    },
    "backgroundImage": {
      "type": "object",
      "required": ["src", "alt"],
      "additionalProperties": false,
      "properties": {
        "src": {
          "type": "string",
          "format": "uri"
        },
        "alt": {
          "type": "string",
          "maxLength": 140
        },
        "credit": {
          "type": "string",
          "maxLength": 140
        },
        "pexelsId": {
          "type": "string",
          "pattern": "^[0-9]+$"
        },
        "cropFocus": {
          "type": "string",
          "enum": ["left", "center", "right", "top", "bottom"]
        }
      }
    },
    "module": {
      "type": "object",
      "required": ["type", "title"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["h5p", "iframe", "link", "form", "video"]
        },
        "title": {
          "type": "string",
          "maxLength": 120
        },
        "description": {
          "type": "string",
          "maxLength": 240
        },
        "sourceUrl": {
          "type": "string",
          "format": "uri"
        },
        "embedHtml": {
          "type": "string",
          "maxLength": 3000
        }
      }
    },
    "learningGoal": {
      "type": "string",
      "maxLength": 140
    },
    "scaffoldingPrompt": {
      "type": "string",
      "maxLength": 160
    },
    "cardObject": {
      "type": "object",
      "required": ["title", "description"],
      "additionalProperties": false,
      "properties": {
        "title": { "type": "string", "maxLength": 64 },
        "description": { "type": "string", "maxLength": 200 }
      }
    },
    "galleryItem": {
      "type": "object",
      "required": ["image", "alt", "caption"],
      "additionalProperties": false,
      "properties": {
        "image": { "type": "string", "format": "uri" },
        "alt": { "type": "string", "maxLength": 140 },
        "caption": { "type": "string", "maxLength": 120 }
      }
    },
    "role": {
      "type": "object",
      "required": ["label", "value"],
      "additionalProperties": false,
      "properties": {
        "label": { "type": "string", "maxLength": 48 },
        "value": { "type": "string", "maxLength": 160 }
      }
    },
    "question": {
      "type": "object",
      "required": ["prompt", "options"],
      "additionalProperties": false,
      "properties": {
        "prompt": { "type": "string", "maxLength": 180 },
        "options": {
          "type": "array",
          "items": { "type": "string", "maxLength": 140 },
          "minItems": 2,
          "maxItems": 5
        },
        "answer": { "type": "string", "maxLength": 140 }
      }
    },
    "slide": {
      "type": "object",
      "required": ["sequence", "archetypeId", "layout", "fields"],
      "additionalProperties": false,
      "properties": {
        "sequence": {
          "type": "integer",
          "minimum": 1,
          "description": "1-indexed order of the slide within the deck."
        },
        "slug": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$"
        },
        "archetypeId": {
          "type": "string",
          "enum": [
            "hero-overlay-intro",
            "grounding-ritual",
            "lesson-aims",
            "scenario-with-media",
            "interactive-checkpoint",
            "task-report",
            "reflection-321",
            "card-stack",
            "pill-gallery"
          ]
        },
        "layout": {
          "type": "string"
        },
        "fields": {
          "type": "object"
        },
        "media": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "backgroundImage": { "$ref": "#/$defs/backgroundImage" },
            "gallery": {
              "type": "array",
              "items": { "$ref": "#/$defs/galleryItem" },
              "minItems": 3,
              "maxItems": 4
            }
          }
        },
        "colors": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "overlayColor": { "$ref": "#/$defs/colorToken" },
            "overlayOpacity": {
              "type": "number",
              "minimum": 0,
              "maximum": 0.9
            },
            "accentColor": { "$ref": "#/$defs/colorToken" }
          }
        },
        "interactiveModules": {
          "type": "array",
          "items": { "$ref": "#/$defs/module" },
          "maxItems": 2
        },
        "notes": {
          "type": "string",
          "maxLength": 280
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "archetypeId": { "const": "hero-overlay-intro" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "topic-introduction" },
              "fields": {
                "type": "object",
                "required": [
                  "title",
                  "hook",
                  "hookIcon",
                  "context",
                  "contextIcon",
                  "essentialQuestion",
                  "essentialQuestionIcon",
                  "keyVocabulary",
                  "keyVocabularyIcon"
                ],
                "additionalProperties": false,
                "properties": {
                  "title": { "type": "string", "maxLength": 80 },
                  "hook": { "type": "string", "maxLength": 200 },
                  "hookIcon": { "$ref": "#/$defs/faIconClass" },
                  "context": { "type": "string", "maxLength": 220 },
                  "contextIcon": { "$ref": "#/$defs/faIconClass" },
                  "essentialQuestion": { "type": "string", "maxLength": 180 },
                  "essentialQuestionIcon": { "$ref": "#/$defs/faIconClass" },
                  "keyVocabulary": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "maxLength": 28
                    },
                    "minItems": 3,
                    "maxItems": 5,
                    "uniqueItems": true
                  },
                  "keyVocabularyIcon": { "$ref": "#/$defs/faIconClass" }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "grounding-ritual" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "grounding-activity" },
              "fields": {
                "type": "object",
                "required": ["title", "subtitle", "steps", "stepsIcon"],
                "additionalProperties": false,
                "properties": {
                  "title": { "type": "string", "maxLength": 80 },
                  "subtitle": { "type": "string", "maxLength": 160 },
                  "steps": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "maxLength": 160
                    },
                    "minItems": 3,
                    "maxItems": 5
                  },
                  "stepsIcon": { "$ref": "#/$defs/faIconClass" }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "lesson-aims" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "learning-objectives" },
              "fields": {
                "type": "object",
                "required": [
                  "title",
                  "goals",
                  "goalIcon",
                  "communicativeGoal",
                  "communicativeGoalIcon"
                ],
                "additionalProperties": false,
                "properties": {
                  "title": { "type": "string", "maxLength": 80 },
                  "goals": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/learningGoal" },
                    "minItems": 3,
                    "maxItems": 4
                  },
                  "goalIcon": { "$ref": "#/$defs/faIconClass" },
                  "communicativeGoal": { "type": "string", "maxLength": 220 },
                  "communicativeGoalIcon": { "$ref": "#/$defs/faIconClass" }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "scenario-with-media" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "communicative-task" },
              "fields": {
                "type": "object",
                "required": [
                  "title",
                  "scenario",
                  "preparation",
                  "preparationIcon",
                  "performance",
                  "performanceIcon",
                  "scaffolding",
                  "scaffoldingIcon"
                ],
                "additionalProperties": false,
                "properties": {
                  "title": { "type": "string", "maxLength": 80 },
                  "scenario": { "type": "string", "maxLength": 120 },
                  "preparation": { "type": "string", "maxLength": 360 },
                  "preparationIcon": { "$ref": "#/$defs/faIconClass" },
                  "performance": { "type": "string", "maxLength": 360 },
                  "performanceIcon": { "$ref": "#/$defs/faIconClass" },
                  "scaffolding": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/scaffoldingPrompt" },
                    "minItems": 3,
                    "maxItems": 4
                  },
                  "scaffoldingIcon": { "$ref": "#/$defs/faIconClass" }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "interactive-checkpoint" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "interactive-practice" },
              "fields": {
                "type": "object",
                "required": [
                  "title",
                  "instructions",
                  "instructionsIcon",
                  "activityType",
                  "activityTypeIcon",
                  "questions"
                ],
                "additionalProperties": false,
                "properties": {
                  "title": { "type": "string", "maxLength": 80 },
                  "instructions": { "type": "string", "maxLength": 320 },
                  "instructionsIcon": { "$ref": "#/$defs/faIconClass" },
                  "activityType": {
                    "type": "string",
                    "enum": [
                      "multiple-choice",
                      "linking",
                      "dropdown",
                      "gapfill",
                      "grouping",
                      "multiple-choice-grid",
                      "ranking",
                      "table-completion",
                      "quiz-show"
                    ]
                  },
                  "activityTypeIcon": { "$ref": "#/$defs/faIconClass" },
                  "questions": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/question" },
                    "minItems": 1,
                    "maxItems": 5
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "task-report" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "task-reporting" },
              "fields": {
                "type": "object",
                "required": [
                  "title",
                  "goal",
                  "goalIcon",
                  "prompts",
                  "promptsIcon",
                  "roles",
                  "rolesIcon",
                  "evidence",
                  "evidenceIcon"
                ],
                "additionalProperties": false,
                "properties": {
                  "title": { "type": "string", "maxLength": 80 },
                  "goal": { "type": "string", "maxLength": 200 },
                  "goalIcon": { "$ref": "#/$defs/faIconClass" },
                  "prompts": {
                    "type": "array",
                    "items": { "type": "string", "maxLength": 160 },
                    "minItems": 3,
                    "maxItems": 3
                  },
                  "promptsIcon": { "$ref": "#/$defs/faIconClass" },
                  "roles": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/role" },
                    "minItems": 2,
                    "maxItems": 4
                  },
                  "rolesIcon": { "$ref": "#/$defs/faIconClass" },
                  "evidence": {
                    "type": "array",
                    "items": { "type": "string", "maxLength": 140 },
                    "minItems": 2,
                    "maxItems": 4
                  },
                  "evidenceIcon": { "$ref": "#/$defs/faIconClass" }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "reflection-321" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "reflection" },
              "fields": {
                "type": "object",
                "required": ["title", "prompts", "promptsIcon"],
                "additionalProperties": false,
                "properties": {
                  "title": { "type": "string", "maxLength": 80 },
                  "prompts": {
                    "type": "array",
                    "items": { "type": "string", "maxLength": 160 },
                    "minItems": 3,
                    "maxItems": 3
                  },
                  "promptsIcon": { "$ref": "#/$defs/faIconClass" }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "card-stack" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "card-stack" },
              "fields": {
                "type": "object",
                "required": [
                  "pill",
                  "pillIcon",
                  "title",
                  "description",
                  "cardIcon",
                  "cards"
                ],
                "additionalProperties": false,
                "properties": {
                  "pill": { "type": "string", "maxLength": 48 },
                  "pillIcon": { "$ref": "#/$defs/faIconClass" },
                  "title": { "type": "string", "maxLength": 80 },
                  "description": { "type": "string", "maxLength": 220 },
                  "cardIcon": { "$ref": "#/$defs/faIconClass" },
                  "cards": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/cardObject" },
                    "minItems": 3,
                    "maxItems": 4
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": { "archetypeId": { "const": "pill-gallery" } }
          },
          "then": {
            "properties": {
              "layout": { "const": "pill-with-gallery" },
              "fields": {
                "type": "object",
                "required": [
                  "pill",
                  "pillIcon",
                  "title",
                  "description",
                  "itemIcon"
                ],
                "additionalProperties": false,
                "properties": {
                  "pill": { "type": "string", "maxLength": 48 },
                  "pillIcon": { "$ref": "#/$defs/faIconClass" },
                  "title": { "type": "string", "maxLength": 80 },
                  "description": { "type": "string", "maxLength": 220 },
                  "itemIcon": { "$ref": "#/$defs/faIconClass" }
                }
              },
              "media": {
                "type": "object",
                "required": ["gallery"],
                "properties": {
                  "gallery": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/galleryItem" },
                    "minItems": 3,
                    "maxItems": 4
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
