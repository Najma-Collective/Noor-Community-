<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A1 Final Assessment: Personal Identity & Introductions</title>

    <!-- 1. Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Questrial&display=swap" rel="stylesheet">

    <!-- 2. Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- 3. Embedded CSS Theme -->
    <style>
        /* =====================================================================
           Noor Community Activities — Enhanced UI System
           Refined version of the Organic Sage visual language.
           ===================================================================== */

        /* -------------------------------
           Design Tokens
        ----------------------------------*/
        :root {
          /* Core Palette */
          --primary-sage: #7a8471;
          --secondary-sage: #9caf88;
          --tertiary-sage: #b8c5a6;
          --warm-cream: #f8f6f0;
          --soft-white: #fefcf7;
          --forest-shadow: #5a6b52;
          --ink: #2f3a2b;
          --ink-muted: #5a6b52;
          --border-sage: rgba(122, 132, 113, 0.2);
          --hover-sage: rgba(156, 175, 136, 0.15);

          /* Extended Palette */
          --deep-forest: #3e4a3a;
          --moss: #6e7a67;
          --amber: #c6aa77;

          /* Typography */
          --font-display: "Questrial", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
          --font-body: "Nunito", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
          --font-size-adjustment: 0rem;
          --step--1: calc(clamp(0.875rem, 0.82rem + 0.18vw, 0.95rem) + var(--font-size-adjustment));
          --step-0:  calc(clamp(1rem, 0.94rem + 0.28vw, 1.1rem) + var(--font-size-adjustment));
          --step-1:  calc(clamp(1.125rem, 1.04rem + 0.42vw, 1.32rem) + var(--font-size-adjustment));
          --step-2:  calc(clamp(1.35rem, 1.18rem + 0.68vw, 1.65rem) + var(--font-size-adjustment));
          --step-3:  calc(clamp(1.75rem, 1.42rem + 1.1vw, 2.1rem) + var(--font-size-adjustment));
          --step-4:  calc(clamp(2.25rem, 1.8rem + 1.65vw, 2.75rem) + var(--font-size-adjustment));

          /* Rhythm & Spacing */
          --space-1: 0.25rem;
          --space-2: 0.5rem;
          --space-3: 0.75rem;
          --space-4: 1rem;
          --space-5: 1.25rem;
          --space-6: 1.5rem;
          --space-7: 2rem;
          --space-8: 2.5rem;
          --space-9: 3rem;

          /* Shape & Elevation */
          --radius-sm: 10px;
          --radius: 16px;
          --radius-lg: 20px;
          --radius-xl: 28px;
          --shadow-1: 0 1px 2px rgba(34, 41, 32, 0.05), 0 2px 8px rgba(34, 41, 32, 0.06);
          --shadow-2: 0 4px 18px rgba(34, 41, 32, 0.08), 0 12px 28px rgba(34, 41, 32, 0.06);
          --shadow-3: 0 10px 40px rgba(34, 41, 32, 0.1), 0 20px 60px rgba(34, 41, 32, 0.08);
          --ring: 0 0 0 3px color-mix(in oklab, var(--soft-white) 60%, transparent),
                   0 0 0 5px color-mix(in srgb, var(--secondary-sage) 85%, #2f3a2b 15%);

          /* Motion */
          --ease-out: cubic-bezier(.2,.8,.2,1);
          --transition-fast: 150ms var(--ease-out);
          --transition-std: 250ms var(--ease-out);

          /* Layout */
          --target-min: 44px;
          --container-max: clamp(320px, 92vw, 940px);
          --container-padding: clamp(1.25rem, 5vw, 2rem);
        }

        /* -------------------------------
           Global Reset & Base Styles
        ----------------------------------*/
        *, *::before, *::after { box-sizing: border-box; }
        html { text-size-adjust: 100%; scroll-behavior: smooth; }
        body { margin: 0; min-height: 100dvh; font-family: var(--font-body); font-size: var(--step-0); line-height: 1.6; color: var(--ink); background: var(--warm-cream); -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; overflow-x: hidden; }
        :where(p, h1, h2, h3, h4, h5, h6) { text-wrap: pretty; overflow-wrap: break-word; }
        :where(h1, h2, h3) { text-wrap: balance; }

        /* -------------------------------
           Typography & Layout
        ----------------------------------*/
        .container { width: 100%; max-width: var(--container-max); margin: 0 auto; padding: 0 var(--container-padding); }
        h1 { font-family: var(--font-display); font-size: var(--step-4); color: var(--forest-shadow); text-align: center; line-height: 1.1; margin: 0 0 var(--space-3); }
        h2 { font-family: var(--font-display); font-size: var(--step-3); color: var(--forest-shadow); margin: var(--space-7) 0 var(--space-4); }
        h3 { font-family: var(--font-display); font-size: var(--step-2); color: var(--forest-shadow); margin: 0 0 var(--space-3); letter-spacing: 0.02em; }
        
        /* -------------------------------
           Buttons
        ----------------------------------*/
        .activity-btn { min-height: var(--target-min); padding: 0.75rem clamp(1.2rem, 4vw, 1.75rem); border-radius: 999px; border: 1px solid color-mix(in srgb, var(--primary-sage) 65%, #fff 35%); background: linear-gradient(180deg, var(--primary-sage), var(--deep-forest)); color: #fff; font-weight: 700; font-size: var(--step-0); letter-spacing: 0.08em; text-transform: uppercase; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.6rem; -webkit-tap-highlight-color: transparent; transition: transform var(--transition-fast), box-shadow var(--transition-std), background var(--transition-std); box-shadow: var(--shadow-1); }
        .activity-btn:hover { transform: scale(1.02); box-shadow: var(--shadow-2); background: linear-gradient(180deg, var(--moss), var(--deep-forest)); }
        .activity-btn:active { transform: scale(0.98); }
        .activity-btn:focus-visible { outline: none; box-shadow: var(--ring), var(--shadow-2); transform: scale(1.02); }
        .activity-btn:disabled { background: var(--tertiary-sage); border-color: color-mix(in srgb, var(--tertiary-sage) 80%, #fff 20%); color: color-mix(in srgb, #fff 85%, var(--soft-white) 15%); cursor: not-allowed; opacity: 0.85; transform: none; box-shadow: none; }

        /* -------------------------------
           Multiple Choice Question Styles
        ----------------------------------*/
        .mc-question { padding: clamp(1.25rem, 4vw, 1.75rem); border-radius: var(--radius); border: 1px solid var(--border-sage); background: linear-gradient(180deg, #fff, color-mix(in srgb, #fff 90%, var(--warm-cream) 10%)); box-shadow: var(--shadow-1); margin-bottom: var(--space-6); }
        .mc-question-text { font-weight: 700; font-size: var(--step-1); color: var(--forest-shadow); line-height: 1.45; margin: 0 0 var(--space-5); }
        .mc-options-container { display: flex; flex-direction: column; gap: var(--space-3); }
        .mc-option-item input { display: none; }
        .mc-option-label { display: flex; align-items: center; gap: var(--space-3); cursor: pointer; padding: 0.75rem 1rem; border-radius: var(--radius-sm); border: 1px solid var(--border-sage); background: color-mix(in srgb, var(--soft-white) 92%, #fff 8%); transition: all var(--transition-std); -webkit-tap-highlight-color: transparent; }
        .mc-option-label:hover { background: var(--hover-sage); border-color: color-mix(in srgb, var(--secondary-sage) 50%, transparent); }
        .mc-option-label .option-control { flex-shrink: 0; width: 24px; height: 24px; border: 2px solid var(--tertiary-sage); background-color: var(--soft-white); transition: all var(--transition-std); position: relative; border-radius: 50%; box-shadow: inset 0 1px 0 rgba(255,255,255,0.7); }
        .mc-option-label.locked { cursor: not-allowed; background: var(--hover-sage); }
        .mc-option-item input:checked + .mc-option-label .option-control { border-color: var(--primary-sage); background-color: var(--primary-sage); }
        .mc-option-item input:checked + .mc-option-label .option-control::after { content: ''; position: absolute; inset: 4px; border-radius: 50%; background-color: #fff; }
        .mc-option-item input:focus-visible + .mc-option-label { outline: none; box-shadow: var(--ring); }
        .mc-option-label:has(input:checked) { border-color: var(--primary-sage); background: color-mix(in srgb, var(--hover-sage) 30%, #fff 70%); }
        .mc-option-label:has(input:checked) .mc-option-text { color: var(--deep-forest); font-weight: 600; }

        /* -------------------------------
           Assessment-Specific Custom Styles
        ----------------------------------*/
        .assessment-container { display: none; }
        #student-id-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        #student-id-box { background: var(--soft-white); padding: var(--space-8); border-radius: var(--radius-lg); text-align: center; box-shadow: var(--shadow-3); width: 90%; max-width: 400px; }
        #student-id-box h2 { margin-top: 0; color: var(--primary-sage); font-family: var(--font-display); }
        #student-id-input { width: 100%; padding: var(--space-3); margin: var(--space-5) 0; border: 1px solid var(--border-sage); border-radius: var(--radius-sm); font-size: var(--step-0); }

        .timer-bar { position: sticky; top: 0; width: 100%; background-color: var(--deep-forest); color: var(--soft-white); padding: var(--space-3) var(--space-4); text-align: center; font-weight: 700; z-index: 999; box-shadow: var(--shadow-2); }
        #countdown-timer { background-color: var(--amber); color: var(--deep-forest); padding: var(--space-1) var(--space-2); border-radius: 6px; margin-left: var(--space-2); }
        
        .hero-section { position: relative; background-size: cover; background-position: center; padding: clamp(3rem, 10vw, 6rem) 1.5rem; text-align: center; color: white; }
        .hero-overlay { position: absolute; inset: 0; background-color: rgba(0, 0, 0, 0.5); }
        .hero-content { position: relative; z-index: 2; }
        .hero-section h1 { color: white; font-size: var(--step-4); }
        .pills { display: flex; justify-content: center; gap: var(--space-3); margin-top: var(--space-4); flex-wrap: wrap; }
        .pill { display: inline-block; padding: var(--space-2) var(--space-4); border-radius: 999px; font-size: var(--step--1); font-weight: 600; background-color: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(5px); }
        
        .assessment-section { margin-bottom: var(--space-8); }
        .instructions { color: var(--ink-muted); font-style: italic; text-align: center; margin-bottom: var(--space-6); }
        .activity-card { background: var(--soft-white); border-radius: var(--radius); padding: var(--space-6); margin-bottom: var(--space-6); box-shadow: var(--shadow-1); border: 1px solid var(--border-sage); }
        .activity-card h3 { color: var(--primary-sage); margin-top: 0; border-bottom: 2px solid var(--hover-sage); padding-bottom: var(--space-2); font-size: var(--step-2); }
        .reading-passage { background-color: color-mix(in srgb, var(--warm-cream) 50%, var(--soft-white) 50%); padding: var(--space-6); border-radius: var(--radius); border: 1px solid var(--border-sage); margin-bottom: var(--space-6); line-height: 1.7; }

        .dropdown-question select { padding: var(--space-2); border-radius: var(--radius-sm); border: 1px solid var(--tertiary-sage); background-color: var(--soft-white); cursor: pointer; }
        .matching-container { display: flex; justify-content: space-between; gap: var(--space-6); }
        .matching-column { width: 48%; }
        .matching-column ul { list-style: none; padding: 0; }
        .matching-column li { padding: var(--space-3); border: 1px solid var(--border-sage); border-radius: var(--radius-sm); margin-bottom: var(--space-2); cursor: pointer; transition: background-color var(--transition-std); }
        .matching-column li:hover { background-color: var(--hover-sage); }
        .matching-column li.selected { background-color: var(--amber); color: var(--deep-forest); border-color: var(--amber); }

        /* Click-to-Move Classification Styles */
        .classification-container { padding: var(--space-4); background-color: color-mix(in srgb, var(--warm-cream) 50%, var(--soft-white) 50%); border-radius: var(--radius); }
        #source-words { padding: var(--space-4); border: 2px dashed var(--tertiary-sage); border-radius: var(--radius-sm); margin-bottom: var(--space-6); display: flex; flex-wrap: wrap; gap: var(--space-2); min-height: 50px; cursor: pointer; }
        .word-token { padding: var(--space-2) var(--space-4); background-color: var(--soft-white); border: 1px solid var(--border-sage); border-radius: 999px; cursor: pointer; box-shadow: var(--shadow-1); transition: all var(--transition-std); }
        .word-token.selected { background-color: var(--amber); color: var(--deep-forest); box-shadow: var(--ring); transform: scale(1.05); }
        .drop-zones { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4); }
        .drop-zone { padding: var(--space-4); border: 1px solid var(--border-sage); border-radius: var(--radius-sm); background-color: var(--soft-white); min-height: 100px; cursor: pointer; }
        .drop-zone h4 { margin-top: 0; text-align: center; color: var(--primary-sage); pointer-events: none; }

        .table-matrix { width: 100%; border-collapse: collapse; }
        .table-matrix th, .table-matrix td { border: 1px solid var(--border-sage); padding: var(--space-3); text-align: left; }
        .table-matrix th { background-color: color-mix(in srgb, var(--warm-cream) 50%, var(--soft-white) 50%); }
        .table-matrix .options-cell button { background-color: var(--soft-white); border: 1px solid var(--tertiary-sage); padding: var(--space-2) var(--space-3); margin: var(--space-1); border-radius: var(--radius-sm); cursor: pointer; }
        .table-matrix .options-cell button.selected { background-color: var(--amber); border-color: var(--amber); font-weight: bold; }

        /* Feedback styling */
        .feedback-correct { background-color: #d4edda !important; border-color: #c3e6cb !important; }
        .feedback-incorrect { background-color: #f8d7da !important; border-color: #f5c6cb !important; }
        .correct-answer-tick::after { content: ' ✔'; color: #155724; font-weight: bold; }
        .mc-option-label.feedback-correct { border-color: #155724 !important; background: #d4edda !important; }
        .mc-option-label.feedback-incorrect { border-color: #721c24 !important; background: #f8d7da !important; }

        #submission-area { text-align: center; margin-top: var(--space-7); }
        #submission-feedback { display: none; padding: var(--space-6); margin-top: var(--space-7); border-radius: var(--radius); text-align: center; }
        #submission-feedback.success { background-color: #d4edda; color: #155724; }
        #submission-feedback.error { background-color: #f8d7da; color: #721c24; }

        /* Mobile Optimization */
        @media (max-width: 600px) {
            .matching-container { flex-direction: column; }
            .matching-column { width: 100%; }
            .table-matrix, .table-matrix tbody, .table-matrix tr, .table-matrix td, .table-matrix th { display: block; }
            .table-matrix thead { display: none; }
            .table-matrix tr { margin-bottom: var(--space-4); border: 1px solid var(--border-sage); border-radius: var(--radius-sm); }
            .table-matrix td { display: flex; justify-content: space-between; align-items: center; border: none; border-bottom: 1px solid var(--border-sage); }
            .table-matrix td:last-child { border-bottom: none; }
            .table-matrix td::before { content: attr(data-label); font-weight: bold; margin-right: var(--space-4); }
        }
    </style>
</head>
<body>

    <div id="student-id-modal">
        <div id="student-id-box">
            <h2>Final Assessment</h2>
            <p>Please enter your numeric Student ID to begin.</p>
            <input type="text" id="student-id-input" placeholder="e.g., 202412345" inputmode="numeric" pattern="[0-9]*">
            <button id="start-assessment-btn" class="activity-btn" disabled>Start Assessment</button>
        </div>
    </div>

    <div class="assessment-container">
        <div class="timer-bar">
            Time Remaining: <span id="countdown-timer">60:00</span>
        </div>

        <header class="hero-section" style="background-image: url('https://images.pexels.com/photos/3182828/pexels-photo-3182828.jpeg?auto=compress&cs=tinysrgb&h=900&w=1600');">
            <div class="hero-overlay"></div>
            <div class="hero-content container">
                <h1>A1 Final Assessment</h1>
                <div class="pills">
                    <span class="pill">Level: A1</span>
                    <span class="pill">Unit Theme: Personal Identity & Introductions</span>
                </div>
            </div>
        </header>

        <main class="container" style="padding-top: 2rem;">

            <section class="assessment-section">
                <h2>Listening Comprehension</h2>
                <p class="instructions">Listen to the conversation and answer the questions.</p>
                
                <audio controls style="width: 100%; margin-bottom: 1.5rem;">
                    <source src="https://najma-collective.github.io/Noor-Community-/A2/1/EOM/download%20(11).wav" type="audio/wav">
                    Your browser does not support the audio element.
                </audio>

                <div class="mc-question" data-question-id="1.1" data-correct-answer="b">
                    <p class="mc-question-text">1. Where are Sara and Omar?</p>
                    <div class="mc-options-container">
                        <div class="mc-option-item"><input type="radio" name="q1.1" value="a" id="q1.1a"><label for="q1.1a" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">a) At a university</span></label></div>
                        <div class="mc-option-item"><input type="radio" name="q1.1" value="b" id="q1.1b"><label for="q1.1b" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">b) At a company event</span></label></div>
                        <div class="mc-option-item"><input type="radio" name="q1.1" value="c" id="q1.1c"><label for="q1.1c" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">c) In a museum</span></label></div>
                    </div>
                </div>
                <div class="mc-question" data-question-id="1.2" data-correct-answer="a">
                    <p class="mc-question-text">2. What is the conversation about?</p>
                    <div class="mc-options-container">
                         <div class="mc-option-item"><input type="radio" name="q1.2" value="a" id="q1.2a"><label for="q1.2a" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">a) Introducing themselves</span></label></div>
                        <div class="mc-option-item"><input type="radio" name="q1.2" value="b" id="q1.2b"><label for="q1.2b" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">b) Saying goodbye</span></label></div>
                        <div class="mc-option-item"><input type="radio" name="q1.2" value="c" id="q1.2c"><label for="q1.2c" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">c) Asking for an address</span></label></div>
                    </div>
                </div>

                <div class="activity-card">
                    <h3>Activity 2: Detailed Information</h3>
                    <p class="instructions" style="text-align:left; font-style:normal;">Click the correct box to complete the table.</p>
                    <table class="table-matrix">
                        <thead><tr><th></th><th>Lives in...</th><th>Job is...</th></tr></thead>
                        <tbody>
                            <tr data-person="sara">
                                <th>Sara</th>
                                <td data-label="Lives in..." class="options-cell" data-category="location" data-correct-answer="Ramallah"><button>Ramallah</button><button>Hebron</button></td>
                                <td data-label="Job is..." class="options-cell" data-category="job" data-correct-answer="Student"><button>Engineer</button><button>Student</button><button>Doctor</button></td>
                            </tr>
                            <tr data-person="omar">
                                <th>Omar</th>
                                <td data-label="Lives in..." class="options-cell" data-category="location" data-correct-answer="Hebron"><button>Ramallah</button><button>Hebron</button></td>
                                <td data-label="Job is..." class="options-cell" data-category="job" data-correct-answer="Engineer"><button>Engineer</button><button>Student</button><button>Doctor</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="assessment-section">
                <h2>Reading Comprehension & Functional Language</h2>
                <p class="instructions">Read the welcome email and answer the questions.</p>
                <div class="reading-passage">
                    <p><strong>Subject: Welcome to the team!</strong></p>
                    <p>Hi Layla,</p>
                    <p>My name is Ahmed. Welcome to the Bank of Palestine. I am a manager here.</p>
                    <p>I am from Nablus, and I live in Ramallah. I am happy to help you with your new job.</p>
                    <p>Please let me know if you have questions.</p>
                    <p>See you tomorrow.</p>
                    <p>Best,<br>Ahmed</p>
                </div>

                <div class="mc-question" data-question-id="3.1" data-correct-answer="c"><p class="mc-question-text">1. Who is the email for?</p><div class="mc-options-container"><div class="mc-option-item"><input type="radio" name="q3.1" value="a" id="q3.1a"><label for="q3.1a" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">a) Ahmed</span></label></div><div class="mc-option-item"><input type="radio" name="q3.1" value="b" id="q3.1b"><label for="q3.1b" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">b) A manager</span></label></div><div class="mc-option-item"><input type="radio" name="q3.1" value="c" id="q3.1c"><label for="q3.1c" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">c) Layla</span></label></div></div></div>
                <div class="mc-question" data-question-id="3.2" data-correct-answer="b"><p class="mc-question-text">2. What is Ahmed's job?</p><div class="mc-options-container"><div class="mc-option-item"><input type="radio" name="q3.2" value="a" id="q3.2a"><label for="q3.2a" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">a) He is a new employee.</span></label></div><div class="mc-option-item"><input type="radio" name="q3.2" value="b" id="q3.2b"><label for="q3.2b" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">b) He is a manager.</span></label></div><div class="mc-option-item"><input type="radio" name="q3.2" value="c" id="q3.2c"><label for="q3.2c" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">c) He is a student.</span></label></div></div></div>
                 <div class="mc-question" data-question-id="3.3" data-correct-answer="b"><p class="mc-question-text">3. Where does Ahmed live?</p><div class="mc-options-container"><div class="mc-option-item"><input type="radio" name="q3.3" value="a" id="q3.3a"><label for="q3.3a" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">a) Nablus</span></label></div><div class="mc-option-item"><input type="radio" name="q3.3" value="b" id="q3.3b"><label for="q3.3b" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">b) Ramallah</span></label></div><div class="mc-option-item"><input type="radio" name="q3.3" value="c" id="q3.3c"><label for="q3.3c" class="mc-option-label"><span class="option-control"></span><span class="mc-option-text">c) Bank of Palestine</span></label></div></div></div>
                
                <div class="activity-card" data-activity-type="matching" data-total-pairs="3">
                    <h3>Activity 4: Language Functions</h3>
                    <p class="instructions" style="text-align:left; font-style:normal;">Match the phrase to its function.</p>
                    <div class="matching-container">
                        <div class="matching-column"><h4>Column A (Phrase)</h4><ul><li data-match-id="1">1. Hi Layla,</li><li data-match-id="2">2. My name is Ahmed.</li><li data-match-id="3">3. See you tomorrow.</li></ul></div>
                        <div class="matching-column"><h4>Column B (Function)</h4><ul><li data-match-id="2">a) Giving information</li><li data-match-id="3">b) Saying goodbye</li><li data-match-id="1">c) Greeting</li></ul></div>
                    </div>
                </div>
            </section>

            <section class="assessment-section">
                <h2>Vocabulary</h2>
                <div class="activity-card" data-activity-type="matching" data-total-pairs="4">
                    <h3>Activity 5: Jobs</h3>
                    <p class="instructions" style="text-align:left; font-style:normal;">Match the job with the description.</p>
                     <div class="matching-container">
                        <div class="matching-column"><h4>Column A (Job)</h4><ul><li data-match-id="1">1. a student</li><li data-match-id="2">2. a doctor</li><li data-match-id="3">3. an engineer</li><li data-match-id="4">4. a teacher</li></ul></div>
                        <div class="matching-column"><h4>Column B (Description)</h4><ul><li data-match-id="2">a) works with sick people.</li><li data-match-id="4">b) helps people learn.</li><li data-match-id="1">c) studies at a university.</li><li data-match-id="3">d) works with buildings and machines.</li></ul></div>
                    </div>
                </div>
                <div class="activity-card" data-activity-type="classify">
                    <h3>Activity 6: Word Groups</h3>
                    <p class="instructions" style="text-align:left; font-style:normal;">Click a word, then click a category to move it.</p>
                    <div class="classification-container">
                        <div id="source-words">
                            <div class="word-token" data-category="Greetings">Hello</div><div class="word-token" data-category="Personal Details">email</div><div class="word-token" data-category="Leave-takings">Goodbye</div><div class="word-token" data-category="Personal Details">address</div><div class="word-token" data-category="Greetings">Hi</div><div class="word-token" data-category="Leave-takings">See you later</div><div class="word-token" data-category="Personal Details">nationality</div>
                        </div>
                        <div class="drop-zones">
                            <div class="drop-zone" data-category="Greetings"><h4>Greetings</h4></div>
                            <div class="drop-zone" data-category="Personal Details"><h4>Personal Details</h4></div>
                            <div class="drop-zone" data-category="Leave-takings"><h4>Leave-takings</h4></div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="assessment-section">
                <h2>Grammar</h2>
                <div class="activity-card">
                    <h3>Activity 7 & 8: Complete Sentences</h3>
                    <p class="instructions" style="text-align:left; font-style:normal;">Choose the correct word.</p>
                    <div class="dropdown-question" data-correct-answer="My">1. Hello. <select name="q7.1"><option value="">--</option><option>My</option><option>I</option></select> name is Fatima.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="am">2. I <select name="q7.2"><option value="">--</option><option>am</option><option>is</option></select> from Palestine.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="you">3. Nice to meet <select name="q7.3"><option value="">--</option><option>you</option><option>your</option></select>.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="an">4. He is <select name="q7.4"><option value="">--</option><option>a</option><option>an</option></select> engineer.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="are">5. You <select name="q7.5"><option value="">--</option><option>is</option><option>are</option></select> a student.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="What's">6. A: <select name="q8.1"><option value="">--</option><option>What's</option><option>Where</option></select> your name? B: My name is Ali.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="are">7. A: Where <select name="q8.2"><option value="">--</option><option>are</option><option>do</option></select> you from? B: I'm from Gaza.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="do">8. A: What <select name="q8.3"><option value="">--</option><option>do</option><option>is</option></select> you do? B: I'm a doctor.</div><hr style="border:0; border-top:1px solid var(--border-sage); margin: var(--space-4) 0;">
                    <div class="dropdown-question" data-correct-answer="do">9. A: Where <select name="q8.4"><option value="">--</option><option>do</option><option>are</option></select> you live? B: I live in Jericho.</div>
                </div>
            </section>

            <div id="submission-area">
                <button id="submit-assessment-btn" class="activity-btn">Submit Final Assessment</button>
            </div>
            <div id="submission-feedback"></div>
        </main>
    </div>

    <script>
    (function() {
        'use strict';
        const DURATION = 60 * 60;
        let timeRemaining = DURATION;
        let timerInterval = null;
        let studentId = '';
        let assessmentSubmitted = false;
        
        // ============================================================================================
        // IMPORTANT: PASTE YOUR NEW WEB APP URL FROM GOOGLE APPS SCRIPT HERE
        // ============================================================================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwI1FuQM8gdwTSvU3FXVB7eX7EFoJCTWj0njCu2I6ibzCq2PtGQg_raW2gpocIVUuOviw/exec';
        // ============================================================================================

        const studentIdModal = document.getElementById('student-id-modal');
        const studentIdInput = document.getElementById('student-id-input');
        const startBtn = document.getElementById('start-assessment-btn');
        const assessmentContainer = document.querySelector('.assessment-container');
        const timerDisplay = document.getElementById('countdown-timer');
        const submitBtn = document.getElementById('submit-assessment-btn');

        studentIdInput.addEventListener('input', () => { startBtn.disabled = !/^\d+$/.test(studentIdInput.value.trim()); });
        startBtn.addEventListener('click', () => {
            studentId = studentIdInput.value.trim();
            studentIdModal.style.display = 'none';
            assessmentContainer.style.display = 'block';
            startTimer();
        });

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = '00:00';
                    handleSubmission(true);
                }
            }, 1000);
        }

        document.querySelectorAll('.mc-options-container input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', e => {
                const container = e.target.closest('.mc-options-container');
                container.querySelectorAll('input[type="radio"]').forEach(input => {
                    input.disabled = true;
                    input.nextElementSibling.classList.add('locked');
                });
            });
        });
        
        document.querySelectorAll('.dropdown-question select').forEach(select => { select.addEventListener('change', e => { e.target.disabled = true; }); });
        document.querySelectorAll('.table-matrix .options-cell button').forEach(button => {
            button.addEventListener('click', e => {
                const cell = e.target.parentElement;
                cell.querySelectorAll('button').forEach(btn => { btn.disabled = true; });
                e.target.classList.add('selected');
            });
        });

        // ===================================================================
        // --- START: MATCHING ACTIVITY ENHANCEMENT (DIFFERENT COLORS) ---
        // ===================================================================
        const matchColors = ['#c6aa77', '#b8c5a6', '#d1bfa2', '#9caf88', '#e3d6c1', '#a7b499'];
        let colorIndex = 0;
        let selectedMatchItem = null;

        document.querySelectorAll('.matching-column li').forEach(item => {
            item.addEventListener('click', e => {
                if (assessmentSubmitted) return;
                const currentItem = e.currentTarget;
                const currentColumn = currentItem.closest('.matching-column');

                if (currentItem.classList.contains('selected')) {
                    currentItem.classList.remove('selected');
                    selectedMatchItem = null;
                    return;
                }

                if (!selectedMatchItem) {
                    // This is the first item selected in a pair.
                    // Deselect any other selected item in the same column.
                    currentColumn.querySelectorAll('li').forEach(li => li.classList.remove('selected'));
                    currentItem.classList.add('selected');
                    selectedMatchItem = currentItem;
                } else if (selectedMatchItem.closest('.matching-column') !== currentColumn) {
                    // This is the second item, and it's in a different column. A match is made.
                    
                    // 1. Get the next color for this pair and increment the index for the next pair.
                    const pairColor = matchColors[colorIndex % matchColors.length];
                    colorIndex++;

                    // 2. Log the user's answer for scoring.
                    selectedMatchItem.dataset.userMatch = currentItem.dataset.matchId;
                    currentItem.dataset.userMatch = selectedMatchItem.dataset.matchId;

                    // 3. Lock both items from being selected again.
                    selectedMatchItem.style.pointerEvents = 'none';
                    currentItem.style.pointerEvents = 'none';
                    
                    // 4. Remove the 'selected' look from the first item.
                    selectedMatchItem.classList.remove('selected');

                    // 5. Apply the unique pair color to both items.
                    selectedMatchItem.style.backgroundColor = pairColor;
                    currentItem.style.backgroundColor = pairColor;
                    selectedMatchItem.style.color = 'var(--deep-forest)'; // Ensure text is readable
                    currentItem.style.color = 'var(--deep-forest)';   // Ensure text is readable

                    // 6. Reset for the next pair.
                    selectedMatchItem = null;
                }
            });
        });
        // =================================================================
        // --- END: MATCHING ACTIVITY ENHANCEMENT ---
        // =================================================================


        let selectedWordToken = null;
        const sourceWordsContainer = document.getElementById('source-words');
        document.querySelectorAll('.word-token').forEach(token => {
            token.addEventListener('click', e => {
                e.stopPropagation();
                if (selectedWordToken) selectedWordToken.classList.remove('selected');
                if (selectedWordToken === e.target) {
                    selectedWordToken = null;
                } else {
                    selectedWordToken = e.target;
                    selectedWordToken.classList.add('selected');
                }
            });
        });
        document.querySelectorAll('.drop-zone, #source-words').forEach(zone => {
            zone.addEventListener('click', e => {
                if (selectedWordToken && e.currentTarget === zone) {
                    zone.appendChild(selectedWordToken);
                    selectedWordToken.classList.remove('selected');
                    selectedWordToken = null;
                }
            });
        });

        submitBtn.addEventListener('click', () => handleSubmission(false));
        
        function handleSubmission(isAutoSubmit) {
            console.log("handleSubmission function started.");

            if (assessmentSubmitted) {
                console.log("Submission blocked because assessmentSubmitted is true.");
                return;
            }
            assessmentSubmitted = true;
            clearInterval(timerInterval);

            if (!isAutoSubmit) {
                console.log("Manual submission. Asking for confirmation.");
                if (!confirm('Are you sure you want to submit?')) {
                    console.log("User cancelled submission.");
                    assessmentSubmitted = false;
                    startTimer();
                    return;
                }
            }

            console.log("Proceeding with submission.");
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const score = calculateScore();
            const total = 32;
            console.log(`Score calculated: ${score}/${total}`);

            showFeedback(score, total);
            
            console.log("Calling submitToGoogleSheet function.");
            submitToGoogleSheet(studentId, 'A1', `${score}/${total}`);
        }

        function calculateScore() {
            let score = 0;
            document.querySelectorAll('.mc-question[data-correct-answer]').forEach(q => { if (q.querySelector('input:checked')?.value === q.dataset.correctAnswer) score++; });
            document.querySelectorAll('.table-matrix .options-cell').forEach(cell => { if (cell.querySelector('button.selected')?.textContent === cell.dataset.correctAnswer) score++; });
            document.querySelectorAll('[data-activity-type="matching"] .matching-column:first-child li').forEach(item => { if (item.dataset.userMatch && item.dataset.matchId === item.dataset.userMatch) score++; });
            document.querySelectorAll('.drop-zone').forEach(zone => { zone.querySelectorAll('.word-token').forEach(token => { if (token.dataset.category === zone.dataset.category) score++; }); });
            document.querySelectorAll('.dropdown-question').forEach(q => { if (q.querySelector('select').value === q.dataset.correctAnswer) score++; });
            return score;
        }

        function submitToGoogleSheet(id, level, finalScore) {
            const formData = new FormData();
            formData.append('Student ID', id);
            formData.append('Level', level);
            formData.append('Score', finalScore);

            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.result === 'success') {
                    console.log('Success:', data);
                    document.getElementById('submission-feedback').innerHTML += `<p>Your results have been successfully recorded.</p>`;
                } else {
                    console.error('Submission Error:', data.error);
                    const feedbackEl = document.getElementById('submission-feedback');
                    feedbackEl.classList.remove('success');
                    feedbackEl.classList.add('error');
                    feedbackEl.innerHTML += `<p>There was an error saving your results. Please contact your teacher.</p>`;
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                const feedbackEl = document.getElementById('submission-feedback');
                feedbackEl.classList.remove('success');
                feedbackEl.classList.add('error');
                feedbackEl.innerHTML += `<p>Could not connect to the server. Please check your internet connection.</p>`;
            });
        }
        
        function showFeedback(score, total) {
            const feedbackEl = document.getElementById('submission-feedback');
            feedbackEl.style.display = 'block';
            feedbackEl.classList.add('success');
            feedbackEl.innerHTML = `<h2>Assessment Complete!</h2><p>Your score is <strong>${score}/${total}</strong>.</p>`;
            window.scrollTo(0, document.body.scrollHeight);
            document.querySelectorAll('.mc-question[data-correct-answer]').forEach(q => {
                q.querySelectorAll('.mc-option-item').forEach(item => {
                    const radio = item.querySelector('input');
                    const label = item.querySelector('label');
                    if (radio.value === q.dataset.correctAnswer) {
                        label.classList.add('feedback-correct');
                    } else if (radio.checked) {
                        label.classList.add('feedback-incorrect');
                    }
                });
            });
        }
    })();
    </script>
</body>
</html>
